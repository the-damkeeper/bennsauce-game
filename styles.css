/* --- Loading Screen --- */
#loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    font-family: 'Ari9500', cursive;
}

/* Ensure crisp pixel art rendering */
.pixel-art, canvas, img {
    image-rendering: -moz-crisp-edges;
    image-rendering: -webkit-crisp-edges;
    image-rendering: pixelated;
    image-rendering: crisp-edges;
}

#loading-content {
    text-align: center;
    color: #fff;
}

#loading-content h1 {
    font-size: var(--font-massive);
    margin-bottom: 2rem;
    color: #4CAF50;
    font-family: 'Ari9500Display';
}

#loading-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #333;
    border-top: 4px solid #4CAF50;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

#loading-text {
    font-size: var(--font-header);
    color: #ccc;
    margin: 0;
    font-family: 'Ari9500';
}

/* --- NEW: Accessibility Styles --- */
.keyboard-focused {
    outline: 3px solid #ffff00 !important;
    outline-offset: 2px !important;
    box-shadow: 0 0 10px rgba(255, 255, 0, 0.5) !important;
}

.high-contrast {
    filter: contrast(1.5) saturate(1.5) !important;
}

.high-contrast .window {
    background-color: #000000 !important;
    color: #ffffff !important;
    border-color: #ffffff !important;
}

.high-contrast button {
    background-color: #ffffff !important;
    color: #000000 !important;
    border: 2px solid #000000 !important;
}

.reduced-motion * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
}

.reduced-motion .shake,
.reduced-motion .bounce,
.reduced-motion .pulse {
    animation: none !important;
    transform: none !important;
}

/* Screen reader only content */
.sr-only {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
}

/* Focus management - remove default outlines */
button:focus,
input:focus,
select:focus,
textarea:focus,
.inventory-slot:focus,
*:focus {
    outline: none !important;
    outline-offset: 0 !important;
}

/* Performance optimizations */
.gpu-accelerated {
    transform: translateZ(0);
    will-change: transform;
}

:root {
    --pixel-art-scale: 3;
    --ui-bg: rgba(20, 30, 40, 0.85);
    --ui-border: #a0b0c0;
    --hp-color: #c0392b;
    --mp-color: #2980b9;
    --exp-color: #f1c40f;
    --bar-bg: #2c3e50;
    --common-color: #ffffff;
    --rare-color: #00aaff;
    --quest-color: #00ff00;
    
    /* Font Size Hierarchy */
    --font-massive: 36px;    /* Main titles, start screen */
    --font-xlarge: 30px;     /* Large headings, critical damage */
    --font-large: 24px;      /* Important UI elements, tooltips */
    --font-header: 20px;     /* Window titles, section headers */
    --font-standard: 16px;   /* Most UI text, buttons, labels */
    --font-small: 12px;      /* Quantities, minor details only */
    --epic-color: #9b59b6;
    --legendary-color: #f39c12;
    --cosmetic-color: #2ecc71; /* New color for cosmetic items */
    --success-color: #2ecc71;
    --fail-color: #e74c3c;
    --destroy-color: #ff9900;
    
    /* Achievement tier colors */
    --achievement-bronze: #cd7f32;
    --achievement-silver: #c0c0c0;
    --achievement-gold: #ffd700;
    --achievement-diamond: #b9f2ff;
    
    /* Hotbar positioning - used for notifications and prompts */
    --hotbar-bottom: 80px;
    --hotbar-height-keyboard: 25px;
    --hotbar-height-gamepad: 25px;
    --hotbar-right: 10px;
    --hotbar-width-keyboard: 460px; /* Approx width of 2-row keyboard hotbar */
    --hotbar-width-gamepad: 480px; /* Approx width of gamepad hotbar */
    /* Gap between elements */
    --ui-gap: 25px;
    --above-hotbar-keyboard: calc(var(--hotbar-bottom) + var(--hotbar-height-keyboard) + var(--ui-gap));
    --above-hotbar-gamepad: calc(var(--hotbar-bottom) + var(--hotbar-height-gamepad) + var(--ui-gap));
    /* Position to the left of hotbar: right edge + hotbar width + gap */
    --left-of-hotbar-keyboard: calc(var(--hotbar-right) + var(--hotbar-width-keyboard) + var(--ui-gap));
    --left-of-hotbar-gamepad: calc(var(--hotbar-right) + var(--hotbar-width-gamepad) + var(--ui-gap));
}

/*debug*/

.debug-hitbox {
    position: absolute;
    background-color: rgba(255, 0, 0, 0.3); /* Semi-transparent red */
    border: 1px solid #ff0000;
    z-index: 1000; /* Increased z-index to draw on top of the player SVG */
    pointer-events: none; /* So they don't interfere with mouse clicks */
    box-sizing: border-box;
    display: none; /* Hidden by default */
}

.debug-hitbox-ladder {
    background-color: rgba(0, 0, 255, 0.3);
    /* Semi-transparent blue */
    border: 1px solid #0000ff;
}

body {
    background-color: #000;
    color: #fff;
    font-family: 'Ari9500', cursive, sans-serif;
    display: flex; /* ADDED */
    justify-content: center; /* ADDED */
    align-items: center; /* ADDED */
    height: 100vh;
    margin: 0;
    overflow: hidden;
    user-select: none;
}

#game-container {
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    overflow: hidden;
    background-color: #000000;
    padding: 0;
    margin: 0;
    box-sizing: border-box;
    /* Force 16:9 aspect ratio and fit within viewport */
    aspect-ratio: 16 / 9;
    width: 100vw;
    height: 100vh;
    max-width: 100vw;
    max-height: 100vh;
}

#scaling-container {
    width: 1366px; /* Target design width */
    height: 768px; /* Target design height */
    position: relative;
    transform-origin: center center;
    max-width: 100vw;
    max-height: 100vh;
    background-color: transparent;
    transition: transform 0.2s ease-out;
    margin: 0;
}

/* --- Responsive Design Enhancements --- */
body {
    margin: 0;
    padding: 0;
    overflow: hidden; /* Prevent scrollbars */
    background-color: #000;
}

html {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-color: #000;
}

body {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* Allow text selection in input fields */
input[type="text"],
textarea,
input[type="number"] {
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
}

/* Ensure anything marked as draggable can actually be dragged */
[draggable="true"] {
    -webkit-user-drag: element;
    user-select: auto;
}

/* Allow text selection in input fields */
input[type="text"], textarea, input[type="number"] {
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
}

/* --- Start Screen --- */
#start-screen {
    position: absolute;
    width: 100%;
    height: 100%;
    background-color: #000;
    z-index: 1000;
    display: none; /* Hidden initially, shown after loading */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: #fff;
}

#start-screen h1 {
    font-size: var(--font-massive);
    color: var(--exp-color);
    text-shadow: 3px 3px #000;
    font-family: 'Ari9500Display';
}

/* Title Card Image */
.title-card-container {
    position: relative;
    display: inline-block;
    margin-bottom: 20px;
}

.title-card {
    image-rendering: pixelated;
    width: 512px;
    height: 128px;
}

.version-number {
    position: absolute;
    top: 15px;
    right: -15px;
    font-family: 'Ari9500';
    font-size: var(--font-large);
    color: #f1c40f;
    text-shadow: 1px 1px 2px #000;
    transform: rotate(10deg);
}

#start-screen button {
    padding: 15px 30px;
    font-size: var(--font-header);
    color: #fffae8;
    background-color: #f1c40f;
    border: 2px solid #fffae8;
    font-family: 'Ari9500';
    font-weight: bold;
    cursor: pointer;
    box-shadow: 3px 3px #000;
    text-shadow: 1px 1px #000000;
}

#start-screen button:hover {
    background-color: #b38f00;
}
/* Polished Input and Select Fields */
#character-name {
    grid-column: 1 / -1; /* Make these span both columns */
    width: 100%;
    padding: 10px;
    margin: 0;
    background-color: var(--bar-bg);
    border: 1px solid var(--ui-border);
    color: #fff;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    box-sizing: border-box;
}

/* Removed resolution-select styles as requested */

#game-world {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
}
#game-clock {
    position: absolute;
    top: 5px;
    right: 10px;
    z-index: 150;
    /* Above the game world but below UI windows */
    color: #f1c40f;
    /* Gold color */
    font-family: 'Ari9500';
    font-weight: bold;
    font-size: var(--font-large);
    padding: 8px 10px;
    text-shadow: 1px 1px 2px #000;
}

#chat-log-container {
    position: absolute;
    bottom: 100%; /* Connects to UI bar */
    left: 0;
    width: 30%;
    height: 150px;
    background-color: rgba(20, 30, 40, 0.6);
    border: 2px solid var(--ui-border);
    border-bottom: none;
    box-sizing: border-box;
    padding: 5px;
    padding-top: 8px; /* Extra padding for resize handle */
    transition: bottom 0.15s ease-out;
}

#chat-log-resize-handle {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 6px;
    cursor: ns-resize;
    background: linear-gradient(to bottom, rgba(255,255,255,0.15) 0%, transparent 100%);
    border-top-left-radius: 2px;
    border-top-right-radius: 2px;
}

#chat-log-resize-handle:hover {
    background: linear-gradient(to bottom, rgba(255,255,255,0.3) 0%, transparent 100%);
}

#chat-log-container.chat-active {
    bottom: calc(100% + 36px); /* Push up when chat input is visible */
}

#chat-log-container.collapsed {
    height: 35px; /* Enough height to show full last line of chat messages */
}

#chat-log {
    width: 100%;
    height: 100%;
    overflow-y: auto;
    font-size: var(--font-standard);
    line-height: 1.2;
    cursor: grab;
    user-select: none;
    pointer-events: auto;
    font-family: 'Ari9500';
    /* ADDED: Explicitly allow mouse events on the log itself */
}

.chat-log-message {
    padding: 2px 4px;
    color: white;
    /* Default chat color */
}

/* Colors for different message types */
.chat-log--system {
    color: #bdc3c7;
}

.chat-log--success {
    color: var(--success-color);
}

.chat-log--fail {
    color: var(--fail-color);
}

.chat-log--destroyed {
    color: var(--destroy-color);
    font-weight: bold;
}

.chat-log--rare {
    color: var(--rare-color);
}

.chat-log--epic {
    color: var(--epic-color);
}

.chat-log--legendary {
    color: var(--legendary-color);
}

.chat-log--player-join {
    color: #4ade80;
    font-style: italic;
    background: rgba(74, 222, 128, 0.15);
    border-left: 3px solid #4ade80;
    padding-left: 5px;
    margin-left: -5px;
}

.chat-log--player-leave {
    color: #f87171;
    font-style: italic;
    background: rgba(248, 113, 113, 0.15);
    border-left: 3px solid #f87171;
    padding-left: 5px;
    margin-left: -5px;
}

.chat-log--party {
    color: #5dade2;
    font-style: italic;
    background: rgba(93, 173, 226, 0.15);
    border-left: 3px solid #5dade2;
    padding-left: 5px;
    margin-left: -5px;
}

.chat-log--boss {
    color: var(--destroy-color);
    font-weight: bold;
}

.chat-log--ghost {
    color: #aaaaff;
}

.chat-log--global {
    color: #ffffff;
    background: linear-gradient(90deg, rgba(241, 196, 15, 0.1) 0%, transparent 100%);
    padding: 2px 4px;
    border-radius: 2px;
    margin: 1px 0;
}

.chat-log--buddy {
    color: #f48fb1;
    background: linear-gradient(90deg, rgba(233, 30, 99, 0.15) 0%, transparent 100%);
    padding: 2px 4px;
    border-radius: 2px;
    margin: 1px 0;
    border-left: 2px solid #e91e63;
    padding-left: 6px;
}

.chat-log--guild {
    color: #ce93d8;
    background: linear-gradient(90deg, rgba(155, 89, 182, 0.15) 0%, transparent 100%);
    padding: 2px 4px;
    border-radius: 2px;
    margin: 1px 0;
    border-left: 2px solid #9b59b6;
    padding-left: 6px;
}

.chat-log--party-chat {
    color: #81d4fa;
    background: linear-gradient(90deg, rgba(52, 152, 219, 0.15) 0%, transparent 100%);
    padding: 2px 4px;
    border-radius: 2px;
    margin: 1px 0;
    border-left: 2px solid #3498db;
    padding-left: 6px;
}

.chat-log--announcement {
    color: #ffd700;
    font-weight: bold;
    background: linear-gradient(90deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 140, 0, 0.1) 50%, transparent 100%);
    padding: 3px 6px;
    border-radius: 3px;
    margin: 2px 0;
    border-left: 3px solid #ffd700;
    text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
}

/* Trade Window Styling */
#trade-window .window-content {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.trade-header {
    text-align: center;
    padding: 10px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 5px;
}

.trade-panels {
    display: flex;
    gap: 10px;
}

.trade-panel {
    flex: 1;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 5px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    position: relative;
}

.trade-confirmed-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    pointer-events: none;
}

.trade-confirmed-overlay span {
    color: #27ae60;
    font-size: 18px;
    font-weight: bold;
    text-shadow: 0 0 10px rgba(39, 174, 96, 0.8), 0 2px 4px rgba(0, 0, 0, 0.8);
    letter-spacing: 2px;
}

.trade-panel-title {
    margin: 0 0 10px 0;
    font-size: 14px;
}

.trade-items-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 5px;
    min-height: 100px;
}

.trade-slot {
    width: 45px;
    height: 45px;
}

.trade-gold-row {
    margin-top: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.trade-gold-label {
    display: flex;
    align-items: center;
    gap: 5px;
}

.trade-coin-icon-wrapper {
    display: inline-block;
    width: 14px;
    height: 14px;
    overflow: hidden;
    vertical-align: middle;
    image-rendering: pixelated;
}

.trade-coin-img {
    display: block;
    width: 56px;
    height: 14px;
    margin-left: 0;
    image-rendering: pixelated;
}

.trade-gold-row input {
    width: 100px;
    padding: 5px;
    background: #2c3e50;
    border: 1px solid #34495e;
    color: white;
    border-radius: 3px;
}

.trade-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 10px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.trade-footer .btn {
    padding: 8px 15px;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    font-size: 13px;
}

.trade-footer .btn-success {
    background: #27ae60;
    color: white;
}

.trade-footer .btn-success:hover {
    background: #2ecc71;
}

.trade-footer .btn-danger {
    background: #c0392b;
    color: white;
}

.trade-footer .btn-danger:hover {
    background: #e74c3c;
}

/* Trade Item Selector Grid */
.trade-selector-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 5px;
    max-height: 250px;
    overflow-y: auto;
}

/* Online Players Styling */
.online-player-entry {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 5px;
    margin-bottom: 5px;
    transition: background 0.2s;
}

.online-player-entry:hover {
    background: rgba(0, 0, 0, 0.5);
}

.online-player-entry.afk {
    opacity: 0.7;
}

.afk-badge {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    background: rgba(255, 165, 0, 0.3);
    color: #ffa500;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 0.75em;
    font-weight: bold;
    margin-left: 8px;
}

.online-player-info {
    display: flex;
    flex-direction: column;
}

.online-player-name {
    font-weight: bold;
    color: #fff;
}

.online-player-details {
    font-size: 0.85em;
    color: #bdc3c7;
}

.online-player-map {
    font-size: 0.85em;
    color: #7f8c8d;
}

.trade-btn {
    padding: 5px 10px;
    background: #3498db;
    border: none;
    border-radius: 3px;
    color: white;
    cursor: pointer;
    font-size: 0.85em;
}

.trade-btn:hover {
    background: #2980b9;
}

/* Party Invite Button */
.party-invite-btn {
    padding: 5px 10px;
    background: #27ae60;
    border: none;
    border-radius: 3px;
    color: white;
    cursor: pointer;
    font-size: 0.85em;
    margin-right: 5px;
}

.party-invite-btn:hover {
    background: #229954;
}

/* Online Player Buttons Container */
.online-player-buttons {
    display: flex;
    align-items: center;
}

/* ============================================
   SOCIAL HUB STYLES
   ============================================ */

/* Social Hub Tabs - Uses global tab styling */
.social-hub-tabs {
    display: flex;
    margin-bottom: 10px;
    border-bottom: 2px solid var(--ui-border);
}

/* Social Tab Content */
.social-tab-content {
    display: none;
    flex: 1;
    overflow-y: auto;
    padding: 5px;
    flex-direction: column;
}

.social-tab-content.active {
    display: flex;
}

/* Buddy List Styles */
.buddy-entry {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 5px;
    margin-bottom: 5px;
    transition: background 0.2s;
}

.buddy-entry:hover {
    background: rgba(0, 0, 0, 0.5);
}

.buddy-entry.offline {
    opacity: 0.6;
}

.buddy-info {
    display: flex;
    flex-direction: column;
}

.buddy-name {
    font-weight: bold;
    color: #fff;
}

.buddy-status {
    font-size: 0.85em;
    color: #7f8c8d;
}

.buddy-status.online {
    color: #2ecc71;
}

.buddy-buttons {
    display: flex;
    gap: 5px;
}

.add-buddy-btn, .remove-buddy-btn {
    padding: 5px 10px;
    border: none;
    border-radius: 3px;
    color: white;
    cursor: pointer;
    font-size: 0.85em;
}

.add-buddy-btn {
    background: #27ae60;
}

.add-buddy-btn:hover {
    background: #229954;
}

.remove-buddy-btn {
    background: #e74c3c;
}

.remove-buddy-btn:hover {
    background: #c0392b;
}

/* ============================================
   PLAYER INSPECTION STYLES
   ============================================ */
#player-inspect-window .window-content {
    padding: 15px;
}

.inspect-header {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: rgba(52, 152, 219, 0.1);
    border: 1px solid rgba(52, 152, 219, 0.3);
    border-radius: 8px;
    margin-bottom: 15px;
    position: relative;
}

.inspect-status-badge {
    position: absolute;
    top: 8px;
    right: 10px;
    font-size: 1.2em;
}

.inspect-avatar {
    width: 120px;
    height: 120px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
    overflow: hidden;
}

.inspect-avatar canvas {
    image-rendering: pixelated;
    image-rendering: crisp-edges;
}

.inspect-basic-info {
    flex: 1;
}

.inspect-name {
    font-size: 1.3em;
    color: #3498db;
    margin-bottom: 5px;
}

.inspect-name .player-title {
    font-size: 0.7em;
    color: #f1c40f;
    margin-left: 8px;
}

.inspect-class {
    font-size: 0.95em;
    color: #bdc3c7;
}

.inspect-guild {
    font-size: 0.85em;
    color: #9b59b6;
    margin-top: 3px;
}

.inspect-section {
    margin-bottom: 15px;
}

.inspect-section h4 {
    color: #f1c40f;
    margin: 0 0 10px 0;
    padding-bottom: 5px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

/* Downed/Rescue System UI */
#downed-ui {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10000;
    background: linear-gradient(135deg, rgba(192, 57, 43, 0.95), rgba(120, 30, 30, 0.95));
    padding: 25px 40px;
    border-radius: 12px;
    border: 3px solid #e74c3c;
    box-shadow: 0 0 40px rgba(231, 76, 60, 0.8), 0 8px 30px rgba(0, 0, 0, 0.8);
    text-align: center;
    animation: downedPulse 1s ease-in-out infinite;
}

@keyframes downedPulse {
    0%, 100% { box-shadow: 0 0 40px rgba(231, 76, 60, 0.8), 0 8px 30px rgba(0, 0, 0, 0.8); }
    50% { box-shadow: 0 0 60px rgba(231, 76, 60, 1), 0 8px 30px rgba(0, 0, 0, 0.8); }
}

.downed-header {
    font-family: 'Ari9500', monospace;
    font-size: 24px;
    font-weight: bold;
    color: #fff;
    text-shadow: 2px 2px 4px #000;
    margin-bottom: 10px;
}

.downed-subtext {
    font-size: 14px;
    color: #ecf0f1;
    margin-bottom: 15px;
}

.downed-timer-container {
    width: 100%;
    height: 12px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 8px;
}

.downed-timer-bar {
    height: 100%;
    background: linear-gradient(90deg, #e74c3c, #f39c12);
    transition: width 0.1s linear;
    width: 100%;
}

.downed-timer-text {
    font-size: 12px;
    color: #bdc3c7;
}

/* Rescue Progress UI */
#rescue-progress-ui {
    position: fixed;
    bottom: 150px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    background: rgba(46, 204, 113, 0.9);
    padding: 12px 25px;
    border-radius: 8px;
    border: 2px solid #27ae60;
    text-align: center;
}

.rescue-progress-text {
    font-family: 'Ari9500', monospace;
    font-size: 14px;
    color: #fff;
    margin-bottom: 8px;
}

.rescue-progress-bar-container {
    width: 200px;
    height: 8px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    overflow: hidden;
}

.rescue-progress-bar {
    height: 100%;
    background: #fff;
    width: 0%;
}

/* Downed Player Indicator on other players */
.downed-player-indicator {
    position: absolute;
    top: -40px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(231, 76, 60, 0.9);
    padding: 4px 10px;
    border-radius: 4px;
    color: #fff;
    font-size: 11px;
    cursor: pointer;
    animation: downedIndicatorPulse 1s ease-in-out infinite;
}

@keyframes downedIndicatorPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

.downed-give-up-btn {
    margin-top: 15px;
    background: linear-gradient(135deg, #7f8c8d, #6c7a7d);
    border: 2px solid #95a5a6;
    color: #fff;
    padding: 10px 25px;
    border-radius: 6px;
    font-family: 'Ari9500', monospace;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.downed-give-up-btn:hover {
    background: linear-gradient(135deg, #95a5a6, #7f8c8d);
}

/* Mailbox UI */
.mailbox-gifts-list {
    max-height: 300px;
    overflow-y: auto;
}

.mailbox-gift-entry {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 6px;
    margin-bottom: 8px;
}

.mailbox-gift-icon {
    font-size: 28px;
    width: 40px;
    text-align: center;
}

.mailbox-gift-info {
    flex: 1;
}

.mailbox-gift-from {
    font-size: 0.85em;
    color: #bdc3c7;
}

.mailbox-gift-item {
    font-weight: bold;
    color: #fff;
}

.mailbox-gift-gold {
    color: #f1c40f;
    font-size: 0.85em;
}

.mailbox-gift-message {
    font-style: italic;
    color: #9b59b6;
    font-size: 0.8em;
    margin-top: 4px;
}

.mailbox-claim-btn {
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    border: none;
    color: #fff;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    font-family: inherit;
    transition: all 0.2s;
}

.mailbox-claim-btn:hover {
    transform: scale(1.05);
}

/* Gift buddy selection */
.gift-buddy-list {
    max-height: 200px;
    overflow-y: auto;
}

.gift-buddy-entry {
    padding: 10px 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    margin-bottom: 6px;
    cursor: pointer;
    transition: all 0.2s;
}

.gift-buddy-entry:hover {
    background: rgba(155, 89, 182, 0.3);
    border-left: 3px solid #9b59b6;
}

.gift-buddy-name {
    color: #fff;
    font-weight: bold;
}

.inspect-stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
}

.inspect-stat {
    display: flex;
    justify-content: space-between;
    padding: 5px 10px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

.inspect-stat-label {
    color: #7f8c8d;
}

.inspect-stat-value {
    color: #ecf0f1;
    font-weight: bold;
}

.inspect-equipment-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
}

.inspect-equip-slot {
    width: 45px;
    height: 45px;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.inspect-equip-slot.empty {
    opacity: 0.5;
}

.inspect-equip-slot img {
    max-width: 40px;
    max-height: 40px;
}

.inspect-equip-slot .slot-label {
    position: absolute;
    bottom: -15px;
    font-size: 0.65em;
    color: #7f8c8d;
    white-space: nowrap;
}

.inspect-btn {
    padding: 8px 16px;
    background: #3498db;
    border: none;
    border-radius: 4px;
    color: white;
    cursor: pointer;
    font-size: 0.85em;
    transition: background 0.2s, transform 0.1s;
    min-width: 100px;
    text-align: center;
}

.inspect-btn:hover {
    background: #2980b9;
    transform: translateY(-1px);
}

.inspect-btn:active {
    transform: translateY(0);
}

.inspect-btn-danger {
    background: #c0392b;
}

.inspect-btn-danger:hover {
    background: #a93226;
}

.inspect-btn-teleport {
    background: #9b59b6;
}

.inspect-btn-teleport:hover {
    background: #8e44ad;
}

.inspect-btn-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
}

.inspect-actions {
    background: rgba(0, 0, 0, 0.2);
    padding: 12px;
    border-radius: 6px;
}

/* ============================================
   ONLINE LIST ENHANCEMENTS
   ============================================ */
.online-player-entry.party-member {
    background: rgba(46, 204, 113, 0.15) !important;
    border-left: 3px solid #2ecc71;
}

.online-player-entry.same-map-party {
    background: rgba(46, 204, 113, 0.25) !important;
    border-left: 3px solid #2ecc71;
    animation: sameMapPulse 2s ease-in-out infinite;
}

@keyframes sameMapPulse {
    0%, 100% { box-shadow: inset 0 0 10px rgba(46, 204, 113, 0.2); }
    50% { box-shadow: inset 0 0 20px rgba(46, 204, 113, 0.4); }
}

.party-indicator {
    color: #2ecc71;
    margin-left: 4px;
}

.activity-status {
    margin-left: 8px;
    font-size: 0.9em;
}

.same-map-tag {
    background: #2ecc71;
    color: #fff;
    padding: 1px 6px;
    border-radius: 3px;
    font-size: 0.75em;
    margin-left: 5px;
    font-weight: bold;
}

/* ============================================
   GLOBAL EVENT BANNER STYLES
   ============================================ */
#global-event-banner {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    background: linear-gradient(135deg, rgba(241, 196, 15, 0.9) 0%, rgba(243, 156, 18, 0.9) 100%);
    border: 2px solid #f39c12;
    border-radius: 8px;
    padding: 8px 20px;
    box-shadow: 0 4px 15px rgba(241, 196, 15, 0.4);
    animation: eventBannerPulse 2s ease-in-out infinite;
}

#global-event-banner.double-exp {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.9) 0%, rgba(39, 174, 96, 0.9) 100%);
    border-color: #27ae60;
    box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
}

#global-event-banner.double-drops {
    background: linear-gradient(135deg, rgba(155, 89, 182, 0.9) 0%, rgba(142, 68, 173, 0.9) 100%);
    border-color: #9b59b6;
    box-shadow: 0 4px 15px rgba(155, 89, 182, 0.4);
}

#global-event-banner.boss-spawn {
    background: linear-gradient(135deg, rgba(231, 76, 60, 0.9) 0%, rgba(192, 57, 43, 0.9) 100%);
    border-color: #e74c3c;
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
}

@keyframes eventBannerPulse {
    0%, 100% { transform: translateX(-50%) scale(1); }
    50% { transform: translateX(-50%) scale(1.02); }
}

#event-banner-content {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #fff;
    font-family: 'Ari9500', cursive;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

#event-banner-icon {
    font-size: 1.3em;
}

#event-banner-text {
    font-size: 1.1em;
    font-weight: bold;
}

#event-banner-timer {
    font-size: 0.9em;
    opacity: 0.9;
    padding-left: 10px;
    border-left: 1px solid rgba(255, 255, 255, 0.3);
}

/* Guild Styles */
.guild-header {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: rgba(155, 89, 182, 0.1);
    border: 1px solid rgba(155, 89, 182, 0.3);
    border-radius: 8px;
    margin-bottom: 15px;
}

/* Guild icon sprite rendering */
.guild-icon-sprite {
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
    -ms-interpolation-mode: nearest-neighbor;
    background-repeat: no-repeat;
}

.guild-icon-display {
    width: 48px;
    height: 48px;
    border-radius: 8px;
    border: 2px solid #9b59b6;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.3);
}

.guild-icon-display img {
    max-width: 100%;
    max-height: 100%;
}

.guild-info-header {
    flex: 1;
}

.guild-info-header h3 {
    margin: 0 0 5px 0;
    color: #9b59b6;
}

.guild-info-header p {
    margin: 0;
    color: #7f8c8d;
    font-size: 0.9em;
}

.guild-members-section {
    margin-bottom: 15px;
}

.guild-members-section h4 {
    color: #9b59b6;
    border-bottom: 1px solid rgba(155, 89, 182, 0.3);
    padding-bottom: 5px;
    margin: 0 0 10px 0;
}

.guild-member-entry {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 10px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    margin-bottom: 5px;
}

.guild-member-entry.leader {
    border-left: 3px solid #f1c40f;
}

.guild-member-entry.online {
    border-left: 3px solid #2ecc71;
}

.guild-member-entry.offline {
    opacity: 0.6;
}

.guild-member-name {
    font-weight: bold;
    color: #fff;
}

.guild-member-rank {
    font-size: 0.8em;
    color: #f1c40f;
}

.guild-member-status {
    font-size: 0.85em;
    color: #7f8c8d;
}

.guild-kick-btn {
    background: rgba(231, 76, 60, 0.6);
    border: none;
    color: #fff;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
}

.guild-kick-btn:hover {
    background: rgba(231, 76, 60, 1);
}

/* Guild Role System */
.guild-role-badge {
    font-size: 12px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.guild-role-buttons {
    display: flex;
    gap: 2px;
}

.guild-role-btn {
    background: rgba(155, 89, 182, 0.6);
    border: none;
    color: #fff;
    width: 18px;
    height: 18px;
    border-radius: 3px;
    cursor: pointer;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s, transform 0.1s;
}

.guild-role-btn:hover {
    transform: scale(1.1);
}

.guild-role-btn.promote {
    background: rgba(46, 204, 113, 0.6);
}

.guild-role-btn.promote:hover {
    background: rgba(46, 204, 113, 1);
}

.guild-role-btn.demote {
    background: rgba(231, 76, 60, 0.6);
}

.guild-role-btn.demote:hover {
    background: rgba(231, 76, 60, 1);
}

/* Guild Buffs Section */
.guild-buffs-section {
    background: rgba(155, 89, 182, 0.1);
    border: 1px solid rgba(155, 89, 182, 0.3);
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
}

.guild-buffs-section h4 {
    color: #9b59b6;
    margin: 0 0 10px 0;
}

.guild-active-buffs {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 10px;
}

.guild-buff-active {
    background: rgba(155, 89, 182, 0.3);
    border: 1px solid rgba(155, 89, 182, 0.5);
    border-radius: 4px;
    padding: 4px 8px;
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.85em;
}

.guild-buff-icon {
    font-size: 14px;
}

.guild-buff-name {
    color: #fff;
}

.guild-buffs-btn {
    background: linear-gradient(135deg, #9b59b6, #8e44ad);
}

/* Guild Buffs Modal Grid */
.guild-buffs-grid {
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 15px;
}

.guild-buff-category {
    margin-bottom: 15px;
}

.guild-buff-category-header {
    font-size: 0.9em;
    color: #f1c40f;
    margin-bottom: 8px;
    padding-bottom: 4px;
    border-bottom: 1px solid rgba(241, 196, 15, 0.3);
}

.guild-buff-item {
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    padding: 8px;
    margin-bottom: 6px;
    transition: all 0.2s;
}

.guild-buff-item.unlocked {
    border-color: rgba(46, 204, 113, 0.5);
    background: rgba(46, 204, 113, 0.1);
}

.guild-buff-item.available {
    border-color: rgba(241, 196, 15, 0.5);
}

.guild-buff-item.available:hover {
    background: rgba(241, 196, 15, 0.1);
}

.guild-buff-icon-large {
    font-size: 24px;
    width: 36px;
    text-align: center;
}

.guild-buff-details {
    flex: 1;
}

.guild-buff-title {
    font-weight: bold;
    color: #fff;
    margin-bottom: 2px;
}

.guild-buff-desc {
    font-size: 0.8em;
    color: #bdc3c7;
}

.guild-buff-cost {
    font-size: 0.8em;
    color: #f1c40f;
    margin-top: 2px;
}

.guild-buff-req {
    font-size: 0.75em;
    color: #e74c3c;
    margin-top: 2px;
}

.guild-buff-status {
    color: #2ecc71;
    font-size: 0.9em;
}

.guild-buff-unlock-btn {
    background: linear-gradient(135deg, #f1c40f, #f39c12);
    border: none;
    color: #000;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-family: inherit;
    font-weight: bold;
    transition: transform 0.2s;
}

.guild-buff-unlock-btn:hover {
    transform: scale(1.05);
}

.guild-challenges {
    background: rgba(46, 204, 113, 0.1);
    border: 1px solid rgba(46, 204, 113, 0.3);
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
}

.guild-challenges h4 {
    color: #2ecc71;
    margin: 0 0 10px 0;
}

.guild-challenge-entry {
    padding: 8px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    margin-bottom: 5px;
}

.guild-challenge-name {
    font-weight: bold;
    color: #fff;
    margin-bottom: 5px;
}

.guild-challenge-progress {
    height: 6px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 3px;
    overflow: hidden;
}

.guild-challenge-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #2ecc71, #27ae60);
    transition: width 0.3s;
}

.guild-challenge-reward {
    font-size: 0.8em;
    color: #f1c40f;
    margin-top: 5px;
}

.guild-action-btn {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 5px;
    color: white;
    cursor: pointer;
    font-family: 'Ari9500', cursive;
    font-size: 0.9em;
    margin-top: 10px;
}

.create-guild-btn {
    background: linear-gradient(135deg, #9b59b6, #8e44ad);
}

.create-guild-btn:hover {
    background: linear-gradient(135deg, #8e44ad, #7d3c98);
}

.leave-guild-btn {
    background: #e74c3c;
}

.leave-guild-btn:hover {
    background: #c0392b;
}

.invite-to-guild-btn {
    padding: 5px 8px;
    background: #9b59b6;
    border: none;
    border-radius: 3px;
    color: white;
    cursor: pointer;
    font-size: 0.8em;
}

.invite-to-guild-btn:hover {
    background: #8e44ad;
}

.no-guild-message {
    text-align: center;
    padding: 30px;
    color: #7f8c8d;
}

.no-guild-message p {
    margin: 5px 0;
}

.guild-icon-selector {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 10px;
    padding: 15px;
    max-height: 200px;
    overflow-y: auto;
}

.guild-icon-option {
    width: 40px;
    height: 40px;
    border: 2px solid transparent;
    border-radius: 5px;
    cursor: pointer;
    background: rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.guild-icon-option:hover {
    border-color: #9b59b6;
    background: rgba(155, 89, 182, 0.2);
}

.guild-icon-option.selected {
    border-color: #9b59b6;
    background: rgba(155, 89, 182, 0.3);
}

.guild-icon-option img {
    max-width: 32px;
    max-height: 32px;
}

/* Party Section Styles */
.party-section {
    background: rgba(93, 173, 226, 0.1);
    border: 1px solid rgba(93, 173, 226, 0.3);
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
}

.party-info {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 8px;
    font-size: 0.9em;
}

.party-members {
    display: flex;
    flex-direction: column;
    gap: 5px;
    margin-bottom: 10px;
}

.party-member-entry {
    display: flex;
    flex-direction: column;
    padding: 6px 10px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    border-left: 3px solid #5dade2;
}

.party-member-entry.same-map {
    border-left-color: #2ecc71;
}

.party-member-name {
    font-weight: bold;
    color: #5dade2;
}

.party-member-details {
    font-size: 0.85em;
    color: #bdc3c7;
}

.party-member-map {
    font-size: 0.8em;
    color: #7f8c8d;
}

.leave-party-btn {
    width: 100%;
    padding: 6px;
    background: #e74c3c;
    border: none;
    border-radius: 4px;
    color: white;
    cursor: pointer;
    font-size: 0.85em;
}

.leave-party-btn:hover {
    background: #c0392b;
}

.party-member-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
}

.party-kick-btn {
    background: #c0392b;
    border: none;
    border-radius: 3px;
    color: white;
    cursor: pointer;
    padding: 1px 4px;
    font-size: 0.65em;
    line-height: 1;
    opacity: 0.7;
    transition: opacity 0.2s, background 0.2s;
}

.party-kick-btn:hover {
    background: #e74c3c;
    opacity: 1;
}

.party-tag {
    color: #5dade2;
    font-size: 0.8em;
}

.in-other-party {
    opacity: 0.7;
}

/* Invite Prompt Container - stacks all invite prompts vertically */
#invite-prompt-container {
    position: fixed;
    bottom: var(--above-hotbar-keyboard);
    right: var(--left-of-hotbar-keyboard);
    z-index: 10000;
    display: flex;
    flex-direction: column-reverse;
    gap: 10px;
    pointer-events: none;
    transition: bottom 0.3s ease, right 0.3s ease;
}

body.gamepad-active #invite-prompt-container {
    bottom: var(--above-hotbar-gamepad);
    right: var(--left-of-hotbar-gamepad);
}

/* Base Invite Prompt - shared styles for all invite/request popups */
.invite-prompt {
    position: relative;
    z-index: 10000;
    background: var(--ui-bg);
    border: 2px solid var(--ui-border);
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    animation: inviteSlideUp 0.3s ease-out;
    text-align: center;
    width: 320px;
    font-family: 'Ari9500', cursive;
    pointer-events: auto;
}

.invite-prompt-title {
    background: var(--ui-border);
    color: #141e28;
    padding: 6px 12px;
    font-size: var(--font-header);
    font-weight: bold;
}

.invite-prompt-content {
    padding: 15px;
    color: #ecf0f1;
    font-size: var(--font-standard);
}

.invite-prompt-content strong {
    color: var(--exp-color);
}

.invite-prompt h3 {
    background: var(--ui-border);
    color: #141e28;
    margin: 0;
    padding: 6px 12px;
    font-size: var(--font-header);
    font-weight: bold;
    border-radius: 3px 3px 0 0;
}

.invite-prompt p {
    color: #ecf0f1;
    margin: 0;
    padding: 15px;
    font-size: var(--font-standard);
}

/* Invite buttons container */
.invite-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    padding: 10px 15px 15px;
}

.invite-accept-btn, .invite-decline-btn {
    padding: 8px 20px;
    border: none;
    border-radius: 3px;
    color: white;
    cursor: pointer;
    font-family: 'Ari9500', cursive;
    font-size: var(--font-standard);
    transition: all 0.2s;
}

.invite-accept-btn {
    background: #27ae60;
    border: 1px solid #2ecc71;
}

.invite-accept-btn:hover {
    background: #2ecc71;
}

.invite-decline-btn {
    background: #7f8c8d;
    border: 1px solid #95a5a6;
}

.invite-decline-btn:hover {
    background: #95a5a6;
}

/* Party Invite Prompt - blue accent */
.party-invite-prompt h3 {
    background: #5dade2;
}

/* Trade Invite Prompt - gold accent */
.trade-invite-prompt h3 {
    background: #f1c40f;
    color: #141e28;
}

/* Buddy Invite Prompt - pink accent */
.buddy-invite-prompt h3 {
    background: #e91e63;
}

/* Guild Invite Prompt - purple accent */
.guild-invite-prompt h3 {
    background: #9b59b6;
}

@keyframes inviteSlideUp {
    from {
        transform: translateY(50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes inviteFadeOut {
    from {
        opacity: 1;
        transform: scale(1);
    }
    to {
        opacity: 0;
        transform: scale(0.95);
    }
}

.invite-prompt.dismissing {
    animation: inviteFadeOut 0.2s ease-out forwards;
    pointer-events: none;
}

/* Guild Modal - centered modals for guild creation/management (NOT invites) */
.guild-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10000;
    background: var(--ui-bg);
    border: 2px solid var(--ui-border);
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    animation: modalFadeIn 0.3s ease-out;
    text-align: center;
    width: 400px;
    font-family: 'Ari9500', cursive;
}

.guild-modal h3 {
    background: var(--ui-border);
    color: #141e28;
    margin: 0;
    padding: 6px 12px;
    font-size: var(--font-header);
    font-weight: bold;
    border-radius: 3px 3px 0 0;
}

.guild-modal p {
    color: #ecf0f1;
    margin: 0;
    padding: 15px 15px 0;
    font-size: var(--font-standard);
    margin: 0 0 10px 0;
}

.guild-modal p {
    color: #ecf0f1;
    margin: 0;
    padding: 15px 15px 0;
    font-size: var(--font-standard);
}

.guild-modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    padding: 15px;
}

.guild-modal-btn {
    padding: 8px 20px;
    border: none;
    border-radius: 3px;
    color: white;
    cursor: pointer;
    font-weight: bold;
    font-family: 'Ari9500', cursive;
    font-size: var(--font-standard);
    transition: all 0.2s;
    border: 1px solid transparent;
}

.guild-modal-btn.confirm {
    background: #27ae60;
    border-color: #2ecc71;
}

.guild-modal-btn.confirm:hover {
    background: #2ecc71;
}

.guild-modal-btn.cancel {
    background: #7f8c8d;
    border-color: #95a5a6;
}

.guild-modal-btn.cancel:hover {
    background: #95a5a6;
}

.guild-modal-btn.danger {
    background: #c0392b;
    border-color: #e74c3c;
}

.guild-modal-btn.danger:hover {
    background: #e74c3c;
}

@keyframes modalFadeIn {
    from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
}

@keyframes modalFadeOut {
    from {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
    to {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
    }
}

/* World Map Player Dots */
.world-map-player-dots {
    position: absolute;
    bottom: -15px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 3px;
    z-index: 10;
}

.player-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    font-size: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
}

.player-dot.party-member {
    background: #5dade2;
    box-shadow: 0 0 4px #5dade2;
}

.player-dot.other-player {
    background: #2ecc71;
    box-shadow: 0 0 4px #2ecc71;
}

/* Trade Window Items */

/* Trade Window Items */
.trade-item-slot {
    width: 40px;
    height: 40px;
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid #34495e;
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    cursor: pointer;
}

.trade-item-slot:hover {
    border-color: #3498db;
}

.trade-item-slot img {
    max-width: 32px;
    max-height: 32px;
    image-rendering: pixelated;
}

.trade-item-slot .item-quantity {
    position: absolute;
    bottom: 1px;
    right: 2px;
    font-size: 10px;
    color: white;
    text-shadow: 1px 1px 1px black;
}

/* Custom Scrollbar for the chat log */
#chat-log::-webkit-scrollbar {
    width: 8px;
}

#chat-log::-webkit-scrollbar-track {
    background: var(--bar-bg);
}

#chat-log::-webkit-scrollbar-thumb {
    background: var(--ui-border);
    border-radius: 4px;
}

#chat-log.active {
    cursor: grabbing;
}

#chat-input-container {
    position: absolute;
    bottom: 100%;
    left: 0;
    width: 30%;
    padding: 5px;
    background-color: var(--ui-bg);
    border-top: 2px solid var(--ui-border);
    display: none;
    /* This makes the input bar hidden by default */
    box-sizing: border-box;
    align-items: center;
    gap: 8px;
}

#chat-channel-indicator {
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    padding: 4px 8px;
    border-radius: 3px;
    white-space: nowrap;
    font-weight: bold;
    text-shadow: 1px 1px 1px #000;
}

#chat-channel-indicator[data-channel="global"] {
    color: #f1c40f;
    background: rgba(241, 196, 15, 0.2);
    border: 1px solid #f1c40f;
}

#chat-channel-indicator[data-channel="buddy"] {
    color: #e91e63;
    background: rgba(233, 30, 99, 0.2);
    border: 1px solid #e91e63;
}

#chat-channel-indicator[data-channel="guild"] {
    color: #9b59b6;
    background: rgba(155, 89, 182, 0.2);
    border: 1px solid #9b59b6;
}

#chat-channel-indicator[data-channel="party"] {
    color: #3498db;
    background: rgba(52, 152, 219, 0.2);
    border: 1px solid #3498db;
}

#chat-input {
    width: 100%;
    padding: 6px;
    background-color: var(--bar-bg);
    border: 1px solid var(--ui-border);
    color: #fff;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    box-sizing: border-box;
    border-radius: 2px;
}

#player-chat-bubble {
    position: absolute;
    top: -60px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(255, 255, 255, 0.9);
    color: #1c2833;
    padding: 6px 10px;
    border-radius: 8px;
    font-size: var(--font-small);
    font-family: 'Ari9500';
    max-width: 300px;
    text-align: center;
    z-index: 100;
    display: none;
    line-height: 1.3;
    /*box-shadow: 2px 2px 5px rgba(0,0,0,0.5);*/
}

#job-adv-content p {
    margin-bottom: 10px; /* Reduced from 25px */
    font-size: var(--font-small); /* Added font size */
    text-align: center;
}

.job-options-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 6px;
    padding: 8px;
    overflow-y: auto;
    box-sizing: border-box;
}

.job-option {
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(52, 73, 94, 0.8));
    border: 2px solid #34495e;
    border-radius: 8px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px; /* Reduced gap for tighter layout */
    transition: all 0.3s ease;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    min-height: 55px; /* Reduced from 65px to fit all 5 options */
}

.job-option:hover {
    border-color: var(--ui-border);
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.6), rgba(52, 73, 94, 0.8));
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
}

.job-icon-container {
    width: 32px; /* Smaller icon since it's beside text */
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    border: 3px solid var(--ui-border);
    flex-shrink: 0; /* Prevent shrinking */
}

.job-info {
    display: flex;
    align-items: center;
    gap: 8px; /* Space between icon and class name */
    text-align: left; /* Align text to the left since icon is on left */
}

.job-class-name {
    font-size: var(--font-small); /* Slightly smaller for horizontal layout */
    font-weight: bold;
    margin: 0;
    color: var(--exp-color);
    font-family: 'Ari9500Display';
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
    line-height: 1.2;
}

.job-description {
    font-size: var(--font-small);
    margin: 0;
    color: #bdc3c7;
    line-height: 1.2;
    font-family: 'Ari9500';
    text-align: center; /* Keep centered */
    flex-grow: 1; /* Allow description to grow and push button to bottom */
}

.job-action {
    display: flex;
    align-items: center;
    margin-top: auto; /* Push to bottom of flex container */
    padding-top: 4px; /* Small space above button */
}

.job-select-btn {
    padding: 6px 12px; /* Reduced padding */
    font-size: var(--font-small);
    font-weight: bold;
    min-width: 70px; /* Reduced from 80px */
    background: linear-gradient(135deg, var(--success-color) 0%, #27ae60 100%);
    border: 2px solid #2ecc71; /* Reduced border */
    color: white;
    transition: all 0.3s ease;
    border-radius: 6px; /* Reduced border radius */
}

.job-select-btn:hover:not(:disabled) {
    background: linear-gradient(135deg, #27ae60 0%, var(--success-color) 100%);
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(46, 204, 113, 0.4); /* Reduced shadow */
}

.job-select-btn:disabled {
    background: #555;
    border-color: #666;
    color: #888;
    cursor: not-allowed;
    opacity: 0.6;
}

#world-content {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background-color: #3498db;
    will-change: transform;
}

#bg-gradient-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 3;
    background: linear-gradient(to bottom, 
        rgba(0, 0, 0, 0) 0%,
        rgba(0, 0, 0, 0) 40%,
        rgba(0, 0, 0, 0.15) 60%,
        rgba(0, 0, 0, 0.5) 80%,
        rgba(0, 0, 0, 1) 100%
    );
}

#world-map-window {
    width: 900px;
    height: 600px;
    top: 75px;
    left: 100px;
    background-color: rgba(20, 30, 40, 0.95);
    display: none; /* Start hidden */
    flex-direction: column; /* Organizes title and content vertically */
}

#world-map-grid {
    position: relative; /* Changed from grid to relative for absolute positioning */
    width: 100%;
    height: 100%;
}

#world-map-connections {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* Allows clicking through the SVG layer */
    z-index: 1; /* Places the lines behind the map nodes */
}

.world-map-node {
    position: absolute; 
    width: 80px; /* Increased for larger font */
    height: 40px; /* Increased for larger font */
    border: 1px solid var(--ui-border);
    border-radius: 3px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: var(--font-small);
    font-family: 'Ari9500';
    text-align: center;
    background-color: #1c2833;
    opacity: 0.4;
    z-index: 2; /* Ensure nodes are on top of the connection lines */
    padding: 4px; /* Increased padding for larger font */
    box-sizing: border-box; /* Ensure padding is included in the size */
}

.world-map-node.discovered {
    opacity: 1; /* Discovered maps are fully visible */
    cursor: pointer;
}

.world-map-node.discovered:hover {
    border-color: var(--exp-color);
}

.world-map-node.selected {
    border: 2px solid #4a90e2;
    background-color: rgba(74, 144, 226, 0.2);
    box-shadow: 0 0 8px rgba(74, 144, 226, 0.5);
}

.world-map-node.current {
    border: 2px solid yellow;
    box-shadow: 0 0 10px yellow;
    font-family: 'Ari9500';
    font-weight: bold;
}

.world-map-player-icon {
    width: 8px;
    height: 8px;
    background-color: yellow;
    border-radius: 50%;
    position: absolute;
    top: 100%; /* Added for centering */
    left: 50%; /* Added for centering */
    border: 2px solid black;
    transform: translate(-50%, -50%);
    z-index: 10;
}

/* World Map Tabs */
.world-map-tab {
    padding: 8px 16px;
    background: rgba(30, 40, 50, 0.8);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 5px 5px 0 0;
    color: rgba(255, 255, 255, 0.6);
    cursor: pointer;
    font-family: 'Ari9500', sans-serif;
    font-size: 13px;
    transition: all 0.2s ease;
}

.world-map-tab:hover {
    background: rgba(50, 70, 90, 0.9);
    color: rgba(255, 255, 255, 0.9);
    border-color: rgba(255, 255, 255, 0.4);
}

.world-map-tab.active {
    background: rgba(74, 144, 226, 0.3);
    border-color: #4a90e2;
    color: #fff;
    border-bottom-color: transparent;
}

.world-map-tab[data-region="dewdrop"].active {
    background: rgba(74, 200, 160, 0.3);
    border-color: #4ac8a0;
}

.world-map-tab[data-region="victoria"].active {
    background: rgba(200, 160, 74, 0.3);
    border-color: #c8a04a;
}

.world-map-tab[data-region="skypalace"].active {
    background: rgba(120, 60, 160, 0.3);
    border-color: #783ca0;
}

#foliage-background-canvas,
#foliage-foreground-canvas {
    position: absolute;
    top: 0;
    left: 0;
    pointer-events: none; /* Allows clicks to pass through */
}

#foliage-background-canvas {
    z-index: 8; /* Behind the player (z-index: 10) */
}

#foliage-foreground-canvas {
    z-index: 11; /* In front of the player */
}
.ladder {
    position: absolute;
    width: 32px; /* Width of the ladder sprite */
    z-index: 6; /* In front of the ground (5) but behind monsters/player (9+) */
    background-repeat: repeat-y;
    background-position: center top; /* Center the graphic horizontally */
}

.npc-quest-indicator {
    position: absolute;
    width: 36px;
    height: 36px;
    z-index: 100;
}

.world-map-quest-indicator {
    position: absolute;
    top: -8px;
    right: -8px;
    width: 16px;
    height: 16px;
    z-index: 3; /* On top of the map node */
}
.parallax-bg {
    position: absolute;
    left: 0;
    top: 0;
    background-repeat: repeat-x;
    z-index: 1;
    overflow: hidden;
}
/* Style for the element being dragged */
.dragging {
    opacity: 0.5;
    border: 2px dashed var(--exp-color);
}

/* Style for a hotbar slot that can receive a drop */
.drag-over {
    background-color: #556677;
    transform: scale(1.1);
}
#tooltip {
    position: fixed;
    /* FIX: Changed from 'absolute' back to 'fixed' */
    display: none;
    background: var(--ui-bg);
    border: 2px solid var(--ui-border);
    padding: 10px;
    border-radius: 5px;
    font-size: var(--font-standard);
    font-family: 'Ari9500';
    pointer-events: none;
    z-index: 99999;
    max-width: 300px;
    transform-origin: top left;
}

#tooltip h4 {
    margin: 0 0 5px 0;
    color: var(--exp-color);
    font-family: 'Ari9500';
    font-size: var(--font-large);
}

#tooltip p {
    margin: 0;
    white-space: pre-wrap; /* Allows for line breaks in descriptions */
}
#tooltip .item-category { color: #aaa; font-size: var(--font-standard); margin-bottom: 5px; font-family: 'Ari9500'; }
#tooltip .cosmetic-info { color: #e74c3c; font-size: var(--font-small); font-style: italic; margin-bottom: 5px; font-family: 'Ari9500'; }
#tooltip h4.common { color: var(--common-color); }
#tooltip h4.rare { color: var(--rare-color); }
#tooltip h4.epic { color: var(--epic-color); }
#tooltip h4.legendary { color: var(--legendary-color); }
#tooltip h4.cosmetic { color: var(--cosmetic-color); }
#tooltip h4.quest { color: var(--quest-color); }

#tooltip .stat-increase {
    color: var(--success-color);
    font-weight: bold;
}

#tooltip .stat-decrease {
    color: var(--fail-color);
    font-weight: bold;
}

#tooltip .stat-missing {
    color: #888;
}

#tooltip .tooltip-stats-divider {
    border-top: 1px solid #444;
    margin: 6px 0;
}

#tooltip .comparison-divider {
    border-top: 1px solid #555;
    margin: 8px 0;
}

#tooltip .comparison-header {
    color: #aaa;
    font-size: 0.9em;
    margin-bottom: 4px;
}

#tooltip .comparison-summary {
    font-weight: bold;
    margin-top: 4px;
    padding: 4px 8px;
    border-radius: 4px;
    text-align: center;
}

#tooltip .comparison-summary.upgrade {
    color: #2ecc71;
    background: rgba(46, 204, 113, 0.15);
    border: 1px solid rgba(46, 204, 113, 0.3);
}

#tooltip .comparison-summary.downgrade {
    color: #e74c3c;
    background: rgba(231, 76, 60, 0.15);
    border: 1px solid rgba(231, 76, 60, 0.3);
}

#tooltip .comparison-summary.sidegrade {
    color: #f39c12;
    background: rgba(243, 156, 18, 0.15);
    border: 1px solid rgba(243, 156, 18, 0.3);
}

#tooltip .comparison-summary.equal {
    color: #95a5a6;
    background: rgba(149, 165, 166, 0.15);
    border: 1px solid rgba(149, 165, 166, 0.3);
}

#tooltip .enhancement-warning {
    color: var(--fail-color);
    font-style: italic;
    font-size: var(--font-standard);
    margin-top: 5px;
    font-family: 'Ari9500';
}

.portal-arrow-prompt {

    position: absolute;
    top: -10px; /* Position above the portal */
    left: 50%;
    transform: translateX(-50%);
    width: 36px;
    height: 36px;
    display: none; /* Hidden by default */
    z-index: 8;
    /*animation: float-up-down 1.5s infinite ease-in-out;*/

}
@keyframes float-up-down {
    0%, 100% {
        transform: translate(-50%, 0);
    }
    50% {
        transform: translate(-50%, -4px);
    }
}

/* This new rule will apply to ALL visual elements inside your game */
#game-container div,
#game-container canvas,
#game-container svg {
    image-rendering: pixelated;
}
#ground-canvas, #platforms-canvas {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 4;
}

.hotkey-notification {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 14px;
    height: 14px;
    background-color: var(--exp-color);
    color: black;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: var(--font-standard);
    font-weight: bold;
    box-shadow: 1px 1px 2px black;
    pointer-events: none; /* So it doesn't interfere with clicks */
}

.hotkey-notification.pixel-art {
    background-color: transparent;
    border-radius: 0;
    box-shadow: none;
    width: 24px;
    height: 24px;
    top: -8px;
    right: -8px;
}
.option-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 4px;
    font-size: var(--font-standard);
    padding: 1px 0;
}
.option-item label {
    flex-basis: 35%;
    text-align: left;
    font-size: var(--font-standard);
}
.option-item input[type="range"] {
    flex-grow: 1;
    margin: 0 10px;
    /* Basic styling for the slider */
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 8px;
    background: var(--bar-bg);
    outline: none;
    border: 1px solid var(--ui-border);
    border-radius: 5px;
}
.option-item input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    background: var(--exp-color);
    cursor: pointer;
    border: 1px solid black;
    border-radius: 50%;
}
.option-item input[type="range"]::-moz-range-thumb {
    width: 16px;
    height: 16px;
    background: var(--exp-color);
    cursor: pointer;
    border: 1px solid black;
    border-radius: 50%;
}
#achievement-window {
    width: 750px;
    top: 100px;
    left: 175px;
}

/* Achievement window tabs */
.achievement-tabs {
    display: flex;
    margin-bottom: 10px;
    border-bottom: 2px solid var(--ui-border);
}

.achievement-tab-button {
    flex: 1;
    padding: 6px;
    background: #34495e;
    color: #ecf0f1;
    border: none;
    cursor: pointer;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    border-right: 1px solid var(--ui-border);
}

.achievement-tab-button:last-child {
    border-right: none;
}

.achievement-tab-button.active {
    background: var(--ui-border);
    color: #141e28;
}

.achievement-tab-button:hover:not(.active) {
    background: #4a6741;
}

.achievement-tab-content {
    display: none;
}

.achievement-tab-content.active {
    display: block;
}

#achievement-list {
    height: 500px;
    overflow-y: auto;
    padding-right: 5px; /* For scrollbar spacing */
}

#medals-list {
    height: 500px;
    overflow-y: auto;
    padding-right: 5px;
}

/* Bestiary Window */
#bestiary-window {
    width: 550px;
    top: 80px;
    left: 200px;
}
.bestiary-tabs {
    display: flex;
    margin-bottom: 10px;
    border-bottom: 2px solid var(--ui-border);
}
.bestiary-tab-button {
    flex: 1;
    padding: 6px;
    background: #34495e;
    color: #ecf0f1;
    border: none;
    cursor: pointer;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    border-right: 1px solid var(--ui-border);
}
.bestiary-tab-button:last-child {
    border-right: none;
}
.bestiary-tab-button.active {
    background: var(--ui-border);
    color: #141e28;
}
.bestiary-tab-button:hover:not(.active) {
    background: #4a6741;
}
/* Bestiary layout */
.bestiary-content-container {
    height: 450px;
    overflow: hidden;
}

.bestiary-split-layout {
    display: none;
    gap: 15px;
    height: 100%;
}

.bestiary-split-layout:has(.bestiary-tab-content.active) {
    display: flex;
}

.bestiary-full-layout {
    display: none;
    height: 100%;
    overflow-y: auto;
}

.bestiary-full-layout:has(.bestiary-tab-content.active) {
    display: block;
}

.bestiary-list-panel {
    flex: 0 0 320px;
    overflow-y: auto;
    padding-right: 5px;
}

.bestiary-detail-panel {
    flex: 1;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 10px;
}

.bestiary-no-selection {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #666;
    font-size: var(--font-standard);
}

.bestiary-tab-content {
    display: none;
}
.bestiary-tab-content.active {
    display: block;
}
.bestiary-monster {
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(52, 73, 94, 0.8));
    border: 2px solid #34495e;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.2s ease;
}
.bestiary-monster.discovered {
    border-color: #5a6d7e;
}
.bestiary-monster.undiscovered {
    opacity: 0.4;
    filter: grayscale(1);
}
.bestiary-monster-info {
    flex: 1;
}
.bestiary-monster-info h4 {
    margin: 0 0 6px 0;
    color: #ecf0f1;
    font-size: var(--font-standard);
    font-weight: bold;
}
.bestiary-monster-info p {
    margin: 3px 0;
    font-size: var(--font-small);
    color: #95a5a6;
}
.bestiary-monster-stats {
    text-align: right;
    font-size: var(--font-small);
    color: #95a5a6;
    min-width: 100px;
}
.bestiary-monster-stats p {
    margin: 3px 0;
}
.bestiary-monster-medals {
    display: flex;
    gap: 5px;
    margin-top: 5px;
}
.bestiary-medal {
    padding: 2px 6px;
    border-radius: 3px;
    font-size: var(--font-small);
    text-shadow: #000000 1px 1px 1px;
    color: white;
    font-weight: bold;
}
.bestiary-medal.bronze { background: var(--achievement-bronze); }
.bestiary-medal.silver { background: var(--achievement-silver); }
.bestiary-medal.gold { background: var(--achievement-gold); }
.bestiary-medal.diamond { background: var(--achievement-diamond); }
.bestiary-stats-section {
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.9), rgba(52, 73, 94, 0.9));
    border: 2px solid #5a6d7e;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}
.bestiary-stats-section h3 {
    margin: 0 0 12px 0;
    color: #ecf0f1;
    font-family: 'Ari9500Display';
    font-size: var(--font-header);
    border-bottom: 2px solid #5a6d7e;
    padding-bottom: 8px;
}
.bestiary-stat-row {
    display: flex;
    justify-content: space-between;
    margin: 8px 0;
    font-size: var(--font-standard);
    font-family: 'Ari9500';
    padding: 4px 0;
}
.bestiary-stat-row span:first-child {
    color: #95a5a6;
}
.bestiary-stat-row span:last-child {
    color: #ecf0f1;
    font-weight: bold;
}

/* Bestiary Progress Bars */
.bestiary-progress-stat {
    margin: 12px 0;
}
.bestiary-progress-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: var(--font-standard);
    font-family: 'Ari9500';
}
.bestiary-progress-header span:first-child {
    color: #bdc3c7;
}
.bestiary-progress-header span:last-child {
    color: #ecf0f1;
    font-weight: bold;
}
.bestiary-progress-bar-container {
    width: 100%;
    height: 8px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 4px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
}
.bestiary-progress-bar {
    height: 100%;
    border-radius: 4px;
    transition: width 0.5s ease-out;
    box-shadow: 0 0 6px rgba(255, 255, 255, 0.2);
}

.bestiary-rare-drop {
    color: var(--rare-color);
    font-weight: bold;
}
.bestiary-monster.clickable {
    cursor: pointer;
    transition: all 0.2s ease;
}
.bestiary-monster.clickable:hover {
    background: #34495e;
    border-color: var(--ui-border);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.bestiary-monster.selected {
    background: #4a90e2;
    border-color: #5fa3e3;
    box-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
}
.bestiary-complete {
    color: var(--success-color);
    font-weight: bold;
}
.bestiary-achievement-complete {
    color: var(--rare-color);
    font-weight: bold;
    text-align: center;
    margin-top: 10px;
    font-size: var(--font-standard);
    font-family: 'Ari9500';
}

/* Monster Detail Modal */
#monster-detail-modal {
    background: var(--ui-bg);
}
.monster-detail-layout {
    display: flex;
    gap: 12px;
    margin-bottom: 8px;
}
.monster-animation-container {
    flex: 0 0 80px;
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 6px;
    padding: 6px;
}
.monster-sprite-animated {
    width: 64px;
    height: 64px;
    display: flex;
    justify-content: center;
    align-items: center;
}
.monster-sprite-animated svg {
    width: 100%;
    height: 100%;
    animation: monsterBob 2s ease-in-out infinite;
}
@keyframes monsterBob {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-3px); }
}
.monster-info-section {
    flex: 1;
}
.monster-info-section h3 {
    margin: 0 0 5px 0;
    color: var(--ui-border);
    font-family: 'Ari9500Display';
    font-size: var(--font-header);
}
.monster-stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2px;
    margin-bottom: 5px;
}
.stat-item {
    display: flex;
    justify-content: space-between;
    font-size: var(--font-standard);
    color: #bdc3c7;
    font-family: 'Ari9500';
}
.stat-item span:first-child {
    color: #ecf0f1;
}
.monster-medals {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
}
.monster-drops-section h4 {
    margin: 0 0 5px 0;
    color: var(--ui-border);
    border-bottom: 1px solid #34495e;
    padding-bottom: 3px;
    font-family: 'Ari9500Display';
    font-size: var(--font-standard);
}
.drops-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(65px, 1fr));
    gap: 4px;
}
.drop-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 4px 3px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    border: 1px solid #34495e;
    text-align: center;
    min-height: 60px;
    transition: all 0.2s ease;
    gap: 1px;
}
.drop-item:hover:not(.undiscovered) {
    scale: 0.98;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}
.drop-item .drop-icon-wrapper,
.drop-item .coin-icon {
    flex-shrink: 0;
    transform: scale(0.75);
    margin: -4px;
}
.drop-item .unknown-icon {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: #7f8c8d;
    flex-shrink: 0;
}
.drop-item.common { border-color: #7f8c8d; }
.drop-item.rare { border-color: var(--rare-color); }
.drop-item.epic { border-color: var(--epic-color); }
.drop-item.legendary { border-color: var(--legendary-color); }
.drop-item.quest { border-color: var(--quest-color); }
.drop-item.undiscovered { 
    border-color: #555; 
    background: rgba(0, 0, 0, 0.4);
    opacity: 0.6;
}
.drop-item.undiscovered .drop-name,
.drop-item.undiscovered .drop-count {
    color: #777;
}
.empty-slot {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: #666;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 3px;
    border: 1px dashed #555;
}
.drop-name {
    font-size: var(--font-small);
    color: #ecf0f1;
    word-break: break-word;
    max-width: 100%;
    line-height: 1.2;
}
.drop-count {
    font-size: var(--font-small);
    color: #bdc3c7;
    margin-top: 1px;
}
.gold-icon, .unknown-icon, .empty-slot {
    width: 32px;
    height: 32px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: var(--font-standard);
}
.unknown-icon {
    background: #555;
    color: #999;
    border-radius: 3px;
}
.achievement-entry {
    background-color: #2c3e50;
    border-left: 4px solid gray;
    padding: 6px;
    margin-bottom: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: var(--font-standard);
    font-family: 'Ari9500';
    border-radius: 0 3px 3px 0;
}
.achievement-entry.bronze { 
    border-color: var(--achievement-bronze); 
    background: linear-gradient(90deg, rgba(205, 127, 50, 0.1) 0%, rgba(44, 62, 80, 1) 100%);
}
.achievement-entry.silver { 
    border-color: var(--achievement-silver); 
    background: linear-gradient(90deg, rgba(192, 192, 192, 0.1) 0%, rgba(44, 62, 80, 1) 100%);
}
.achievement-entry.gold { 
    border-color: var(--achievement-gold); 
    background: linear-gradient(90deg, rgba(255, 215, 0, 0.15) 0%, rgba(44, 62, 80, 1) 100%);
}
.achievement-entry.diamond { 
    border-color: var(--achievement-diamond); 
    background: linear-gradient(90deg, rgba(185, 242, 255, 0.15) 0%, rgba(44, 62, 80, 1) 100%);
}
.achievement-entry.claimable {
    box-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
    animation: achievementPulse 2s infinite;
}
.achievement-entry.completed { opacity: 0.6; }

@keyframes achievementPulse {
    0%, 100% { box-shadow: 0 0 10px rgba(241, 196, 15, 0.3); }
    50% { box-shadow: 0 0 20px rgba(241, 196, 15, 0.6); }
}

/* Medal entries - same style as achievements */
.medal-entry {
    background-color: #2c3e50;
    border-left: 4px solid gray;
    padding: 6px;
    margin-bottom: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: var(--font-standard);
    font-family: 'Ari9500';
    border-radius: 0 3px 3px 0;
}

.medal-entry.bronze { 
    border-color: var(--achievement-bronze); 
    background: linear-gradient(90deg, rgba(205, 127, 50, 0.1) 0%, rgba(44, 62, 80, 1) 100%);
}
.medal-entry.silver { 
    border-color: var(--achievement-silver); 
    background: linear-gradient(90deg, rgba(192, 192, 192, 0.1) 0%, rgba(44, 62, 80, 1) 100%);
}
.medal-entry.gold { 
    border-color: var(--achievement-gold); 
    background: linear-gradient(90deg, rgba(255, 215, 0, 0.15) 0%, rgba(44, 62, 80, 1) 100%);
}
.medal-entry.diamond { 
    border-color: var(--achievement-diamond); 
    background: linear-gradient(90deg, rgba(185, 242, 255, 0.15) 0%, rgba(44, 62, 80, 1) 100%);
}
.medal-entry.epic { 
    border-color: var(--epic-color); 
    background: linear-gradient(90deg, rgba(153, 50, 204, 0.15) 0%, rgba(44, 62, 80, 1) 100%);
}
.medal-entry.legendary { 
    border-color: var(--legendary-color); 
    background: linear-gradient(90deg, rgba(255, 153, 0, 0.15) 0%, rgba(44, 62, 80, 1) 100%);
}
.medal-entry.rare { 
    border-color: var(--rare-color); 
    background: linear-gradient(90deg, rgba(68, 136, 255, 0.1) 0%, rgba(44, 62, 80, 1) 100%);
}

.medal-entry.locked {
    opacity: 0.5;
}

.medal-entry.equipped {
    box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
    border-color: #4CAF50;
}

.medal-entry.displayed {
    box-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
    border-color: #2196F3;
}

.medal-entry.equipped.displayed {
    box-shadow: 0 0 10px rgba(76, 175, 80, 0.5), 0 0 15px rgba(33, 150, 243, 0.3);
}

.medal-info {
    flex: 1;
}

.medal-info h4 { 
    margin: 0 0 4px 0; 
    font-size: var(--font-standard); 
    font-family: 'Ari9500'; 
    font-weight: bold; 
}

.medal-info p { 
    margin: 0; 
    font-size: var(--font-standard); 
    color: #bdc3c7; 
    font-family: 'Ari9500'; 
}

.medal-info small {
    color: #888;
    font-size: var(--font-small);
}

.medal-actions {
    display: flex;
    flex-direction: column;
    gap: 4px;
    align-items: flex-end;
}

.medal-actions button {
    padding: 4px 10px;
    font-size: var(--font-small);
    min-width: 70px;
}

.medal-actions button.equipped-btn {
    background-color: #4CAF50;
    border-color: #66bb6a;
}

.medal-actions button.equipped-btn:hover {
    background-color: #388E3C;
}

.medal-section-header {
    background: rgba(0, 0, 0, 0.3);
    padding: 8px 10px;
    margin: 10px 0 6px 0;
    border-radius: 3px;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    color: #ffd700;
    border-left: 3px solid #ffd700;
}

.medal-section-header:first-child {
    margin-top: 0;
}

.achievement-info h4 { margin: 0 0 4px 0; font-size: var(--font-standard); font-family: 'Ari9500'; font-weight: bold; }
.achievement-info p { margin: 0; font-size: var(--font-standard); color: #bdc3c7; font-family: 'Ari9500'; }
.achievement-progress {
    width: 100%;
    background-color: var(--bar-bg);
    height: 8px;
    border-radius: 4px;
    margin-top: 4px;
}
.achievement-progress-fill {
    height: 100%;
    background-color: var(--exp-color);
    border-radius: 4px;
}
.achievement-reward button {
    padding: 5px 10px;
    font-size: var(--font-standard);
    margin: 0;
}
.achievement-reward button:disabled {
    background-color: #333;
    color: #888;
    cursor: not-allowed;
}
.window-content-button, .option-item button {
    padding: 8px 16px;
    border: 1px solid #fff;
    background-color: #555;
    color: #fff;
    font-family: 'Ari9500';
    cursor: pointer;
    font-size: var(--font-standard);
    box-shadow: 1px 1px #000;
    margin: 0;
    border-radius: 2px;
}
.window-content-button:hover, .option-item button:hover {
    background-color: #777;
}

/* Hotbar slot assignment buttons */
.hotbar-slot-btn {
    padding: 15px 10px;
    min-height: 80px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.hotbar-slot-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
    border-color: var(--rare-color);
}

#fade-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: #000;
    z-index: 9999; /* Ensures it's on top of all other game elements */
    opacity: 0;
    pointer-events: none; /* Allows clicks to pass through when transparent */
    transition: opacity 0.25s ease-in-out;
}
#fade-overlay.active {
    opacity: 1;
    pointer-events: auto; /* Blocks clicks during the transition */
}

/* Fade overlay transition classes for character creation */
#fade-overlay.fade-to-black {
    opacity: 1;
    pointer-events: auto;
    transition: opacity 0.25s ease-in-out;
}

#fade-overlay.fade-from-black {
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease-in-out;
}

/* Welcome Popup */
#welcome-popup {
    pointer-events: auto;
}

#welcome-popup .window-title {
    cursor: default !important;
    pointer-events: none;
}

#settings-footer {
    margin-top: 8px;
    padding: 8px;
    border-top: 1px solid var(--ui-border);
    display: flex;
    justify-content: space-around;
    gap: 10px;
    background-color: var(--ui-bg);
    position: relative;
    /* ADD THIS LINE */
    z-index: 1;
    /* ADD THIS LINE */
}
#settings-footer button {
    flex: 1;
    padding: 8px 16px;
    border: 1px solid #fff;
    background-color: #555;
    color: #fff;
    font-family: 'Ari9500';
    cursor: pointer;
    font-size: var(--font-standard);
    box-shadow: 1px 1px #000;
    margin: 0;
    border-radius: 2px;
}
#settings-footer button:hover {
    background-color: #777;
}    

/* --- Button Hover Effects --- */
/* For the main buttons like 'Create Character', 'Back', and 'Create New' */
#character-creation button:hover,
#character-selection-screen button:hover {
    background-color: #b38f00;
}

/* --- FINAL Character Creation & Selection CSS --- */

/* Base styles for both screens */
#character-selection-screen,
#character-creation {
    background-color: var(--ui-bg);
    border: 2px solid var(--ui-border);
    border-radius: 0px;
    box-sizing: border-box;
    padding: 24px;
    height: auto;
    z-index: 999;
    position: relative; /* Ensure it's on top of the game world */
}

/* Specific styles for the SELECTION screen */
#character-selection-screen {
    width: 580px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

/* Specific styles for the CREATION screen */
#character-creation {
    width: 512px;
    height: 512px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: absolute; /* This is the key change */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

#creation-bg-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: -1;
    pointer-events: none;
    image-rendering: pixelated;
}

#character-sprite-viewer {
    position: absolute;
    transform: translate(-50%, -100%);
    image-rendering: pixelated;
}

        
/* Universal button styling for this screen */
#character-creation button, #character-selection-screen button {
    padding: 10px 15px; /* Reduced padding */
    border: 2px solid #fffae8;
    color: #fffae8;
    font-family: 'Ari9500', cursive;
    cursor: pointer;
    font-size: var(--font-standard);
    background-color: #f1c40f;
    box-shadow: 2px 2px #202020;
    margin-top: 0; /* Remove top margin from individual buttons */
    text-shadow: 1px 1px #000000;
}

#character-selection-screen button {
    margin-top: 20px; /* Add margin only to the button on the selection screen */
    text-shadow: 1px 1px #000000;
}

/* --- NEW AND UPDATED CHARACTER CREATION CSS --- */

/* Main layout for the entire creation screen content */
#creation-layout {
    display: grid;
    /* A column for the preview, a column for controls */
    grid-template-columns: 140px 5fr;
    gap: 20px;
    align-items: center;
    width: 100%; /* Ensure it uses the full width of its parent */
}

/* Container for the character preview canvas */
#character-preview-area {
    width: 100%;
    height: 150px; /* Give it a fixed height */
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 5px;
}

/* Grid for all the input controls */
#creation-controls {
    display: grid;
    grid-template-columns: 90px 1fr;
    gap: 12px 10px;
    align-items: center;
    
    /* --- ADD THESE LINES --- */
    background-color: rgba(39, 39, 39, 0.459); /* Dark grey transparent background */
    padding: 20px;                            /* Adds space inside the box */
    border-radius: 8px;                       /* Creates the rounded corners */
}

/* Make these specific elements span both columns of the controls grid */
#character-name,
#dice-roll-container,
#creation-actions {
    grid-column: 1 / -1;
}

/* Styling for the dice roll container */
#dice-roll-container {
    display: flex;
    flex-direction: column;
    gap: 8px;
    background-color: rgba(0, 0, 0, 0.2);
    padding: 10px;
    border-radius: 4px;
    border: 1px solid var(--ui-border);
}

/* Stat display inside the dice container */
#stat-display {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 5px;
    text-align: center;
    font-size: var(--font-standard);
    text-shadow: 1px 1px #000000;
    font-family: 'Ari9500';
}
#stat-display b {
    color: var(--exp-color);
}

 #stat-display span {
    color: #bdc3c7;
    white-space: nowrap;
 }


/* Styling for labels like "Hair Style" */
.control-label {
    font-size: var(--font-standard);
    text-align: right;
    color: #ffffff;
    font-family: 'Ari9500';
    text-shadow: 1px 1px #000000;
}

/* Container for < > buttons and the value */
.custom-control {
    display: grid;
    grid-template-columns: 40px 1fr 40px; /* Button, Value, Button */
    align-items: center;
    text-align: center;
}
.custom-control button {
    margin: 0;
    padding: 5px;
    text-shadow: 1px 1px #000000;
}

/* The text or color swatch between the buttons */
.control-value, #hair-color-box, #skin-color-box {
    background-color: var(--bar-bg);
    padding: 6px 0;
    font-size: var(--font-small);
    height: 24px;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    text-shadow: 1px 1px #000000;
}

#hair-color-box, #skin-color-box {
    width: auto;
    border: 1px solid var(--ui-border);
    margin: 0 5px;
}

.dice-btn {
    width: 30px;
    height: 30px;
    padding: 0;
    font-size: var(--font-standard);
    cursor: pointer;
    background: linear-gradient(180deg, #555, #333);
    border: 2px solid var(--ui-border);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    position: absolute;
    right: 5px;
}

#random-name-btn {
    top: 30px;
    right: 50px;
}

#random-appearance-btn {
    top: 465px;
    right: 462px;
}

.dice-btn:hover {
    background: linear-gradient(180deg, #666, #444);
    transform: scale(1.05);
}

.dice-btn:active {
    transform: scale(0.95);
}

/* Container for the final Create/Back buttons */
#creation-actions {
    margin-top: 15px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    text-shadow: 1px 1px #000000;
}

#start-game-btn {
    background-color: var(--success-color);
    visibility: hidden;
}

#back-to-select-btn {
    background-color: #4a4a4a;
}
#character-list {
    width: 80%;
    max-width: 400px;
    max-height: 250px;
    overflow-y: auto;
    border: 2px solid var(--ui-border);
    padding: 10px;
    background: var(--ui-bg);
}
.character-slot {
    padding: 10px;
    margin-bottom: 5px;
    background: #2c3e50;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 2px solid transparent;
    transition: all 0.2s ease;
}
.character-slot:hover {
    background: #34495e;
}
/* Gamepad selection styling - visible when gamepad is connected */
body.gamepad-active .character-slot.gamepad-selected {
    background: #34495e;
    border-color: #3498db;
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
}
body.gamepad-active #create-new-char-btn.gamepad-selected {
    border-color: #3498db;
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
    transform: scale(1.05);
}

/* Universal gamepad selection styling - visible when gamepad is connected */
body.gamepad-active .inventory-slot.gamepad-selected,
body.gamepad-active .equipment-slot.gamepad-selected,
body.gamepad-active .skill-item.gamepad-selected,
body.gamepad-active .skill-node.gamepad-selected,
body.gamepad-active .stat-add-btn.gamepad-selected,
body.gamepad-active .quest-item.gamepad-selected,
body.gamepad-active .monster-entry.gamepad-selected,
body.gamepad-active .achievement-item.gamepad-selected,
body.gamepad-active .shop-item.gamepad-selected,
body.gamepad-active button.gamepad-selected,
body.gamepad-active input.gamepad-selected,
body.gamepad-active select.gamepad-selected {
    outline: 2px solid #3498db;
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
    background-color: rgba(52, 152, 219, 0.1);
}

/* Virtual mouse cursor */
#virtual-mouse-cursor {
    position: fixed;
    width: 20px;
    height: 20px;
    pointer-events: none;
    z-index: 99999;
    display: none;
    background: rgba(255, 215, 0, 0.8);
    border: 2px solid white;
    border-radius: 50%;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 0 5px rgba(255, 255, 255, 0.6);
    animation: pulse-cursor 1s infinite;
    transition: opacity 0.3s ease-out, transform 0.15s ease-out;
    transform-origin: center center;
}

/* Show cursor when gamepad is active */
.gamepad-active #virtual-mouse-cursor {
    display: block !important;
    /* Opacity is controlled by JavaScript based on left stick movement */
}

@keyframes pulse-cursor {
    0%, 100% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 0 5px rgba(255, 255, 255, 0.6); }
    50% { box-shadow: 0 0 20px rgba(255, 215, 0, 1), 0 0 10px rgba(255, 255, 255, 0.8); }
}

/* Virtual Keyboard */
#virtual-keyboard {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(20, 20, 30, 0.98);
    border: 2px solid var(--legendary-color);
    border-radius: 10px;
    padding: 15px;
    z-index: 100000;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
    min-width: 600px;
    font-family: 'Ari9500', cursive;
}

.virtual-keyboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--legendary-color);
}

#virtual-keyboard-input-display {
    color: #ffffff;
    font-size: var(--font-standard);
    flex: 1;
    padding: 8px 12px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 5px;
    min-height: 30px;
    margin-right: 10px;
}

#virtual-keyboard-close {
    background: var(--hp-color);
    border: none;
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 18px;
    transition: all 0.2s;
}

#virtual-keyboard-close:hover {
    background: #e74c3c;
    transform: scale(1.1);
}

.virtual-keyboard-keys {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.virtual-keyboard-row {
    display: flex;
    justify-content: center;
    gap: 6px;
}

.virtual-keyboard-key {
    background: linear-gradient(135deg, #3a3a50 0%, #2a2a40 100%);
    border: 2px solid #555;
    color: #ffffff;
    padding: 12px 18px;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.15s;
    font-size: var(--font-standard);
    min-width: 45px;
    text-align: center;
    user-select: none;
}

.virtual-keyboard-key:hover {
    background: linear-gradient(135deg, #4a4a60 0%, #3a3a50 100%);
    border-color: var(--legendary-color);
    transform: translateY(-2px);
}

.virtual-keyboard-key.selected {
    background: linear-gradient(135deg, var(--legendary-color) 0%, #cc9900 100%);
    border-color: #ffffff;
    color: #000;
    font-weight: bold;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
    animation: pulse-key 1s infinite;
}

.virtual-keyboard-key.wide-key {
    min-width: 120px;
    padding: 12px 30px;
}

@keyframes pulse-key {
    0%, 100% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.8); }
    50% { box-shadow: 0 0 25px rgba(255, 215, 0, 1); }
}

/* Radial Menu */
#gamepad-radial-menu {
    display: none;
    animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

.radial-menu-item {
    transition: all 0.2s ease;
    font-family: Arial, sans-serif;
}

.radial-menu-item:hover {
    cursor: pointer;
}

/* Gamepad Dropdown Mapping Styles */
.gamepad-dropdown-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-height: 300px;
    overflow-y: auto;
}

.gamepad-dropdown-item {
    display: grid;
    grid-template-columns: 200px 1fr auto;
    align-items: center;
    gap: 15px;
    padding: 10px;
    background: #2a2a2a;
    border-radius: 6px;
    border: 1px solid #444;
}

.gamepad-dropdown-item.locked {
    opacity: 0.6;
    background: #252525;
}

.gamepad-button-label {
    font-weight: bold;
    color: #fff;
    font-size: var(--font-small);
}

.gamepad-action-select {
    padding: 6px 10px;
    background: #1a1a1a;
    border: 1px solid #555;
    border-radius: 4px;
    color: #ffd700;
    font-size: var(--font-small);
    cursor: pointer;
    font-family: inherit;
}

.gamepad-action-select:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #151515;
}

.gamepad-action-select:hover:not(:disabled) {
    border-color: #ffd700;
    background: #222;
}

.gamepad-duplicate-warning {
    color: #e74c3c;
    font-size: var(--font-small);
    font-weight: bold;
}

#player {
    position: absolute;
    width: 60px; 
    height: 60px;
    transition: opacity 0.1s linear;
    z-index: 10;
    pointer-events: none;
}
#player-hp-bar-container {
    position: absolute;
    top: -25px;
    left: 0;
    width: 100%;
    height: 8px;
    background-color: #333;
    border: 1px solid black;
    border-radius: 3px;
    display: none;
}
#player-hp-bar-fill {
    height: 100%;
    background-color: var(--hp-color);
    border-radius: 2px;
    transition: width 0.2s linear;
}
#player-nameplate {
    position: absolute;
    top: 60px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-size: var(--font-small);
    font-family: 'Ari9500';
    font-weight: bold;
    text-shadow: 1px 1px 2px #000;
    white-space: nowrap;
    padding: 2px 6px;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    image-rendering: pixelated;
    line-height: 1;
}

.npc-nameplate {
    position: absolute;
    top: 60px;
    left: 50%;
    transform: translateX(-50%);
    color: #f1c40f;
    font-size: var(--font-small);
    font-family: 'Ari9500';
    font-weight: bold;
    text-shadow: 1px 1px 2px #000;
    white-space: nowrap;
    padding: 4px 8px;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    image-rendering: pixelated;
}

.npc.pixel-art .npc-nameplate {
    top: 98px;
}

/* Player-sprite NPCs have same positioning as ghost players */
.npc.player-sprite .npc-nameplate {
    top: 60px;
}

.monster-nameplate {
    position: absolute;
    top: 60px;
    left: 50%;
    transform: translateX(-50%);
    font-size: var(--font-small);
    font-family: 'Ari9500';
    text-shadow: 1px 1px 2px #000;
    white-space: nowrap;
    padding: 4px 8px;
    margin-bottom: 4px;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    image-rendering: pixelated;
    display: none;
}

#guild-nameplate {
    position: absolute;
    top: 78px;
    /* Positioned below the player-nameplate */
    left: 50%;
    transform: translateX(-50%);
    color: white;
    /* A light blue color for the guild name */
    font-size: var(--font-small);
    font-family: 'Ari9500';
    font-weight: bold;
    text-shadow: 1px 1px 2px #000;
    white-space: nowrap;
    display: none;
    /* Aligns the icon and text side-by-side */
    align-items: center;
    gap: 4px;
    image-rendering: pixelated;
    line-height: 1;
    padding: 2px 6px;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    /* Adds a small space between the icon and name */
}

#guild-icon {
    display: inline-block;
    font-size: 12px;
    line-height: 1;
}
.weapon-glow-blue .pixel-art {
    filter: drop-shadow(0 0 1px #00ccff) drop-shadow(0 0 0.5px #66ddff);
    animation: glow-blue-anim 2.5s ease-in-out infinite alternate;
}
.weapon-glow-red .pixel-art {
    filter: drop-shadow(0 0 1px #ff4444) drop-shadow(0 0 0.5px #ff7777);
    animation: glow-red-anim 2s ease-in-out infinite alternate;
}
@keyframes glow-blue-anim {
    from { filter: drop-shadow(0 0 0.5px #00ccff) drop-shadow(0 0 0.25px #66ddff); }
    to { filter: drop-shadow(0 0 1.5px #00ccff) drop-shadow(0 0 1px #66ddff); }
}
@keyframes glow-red-anim {
    from { filter: drop-shadow(0 0 0.5px #ff4444) drop-shadow(0 0 0.25px #ff7777); }
    to { filter: drop-shadow(0 0 1.5px #ff4444) drop-shadow(0 0 1px #ff7777); }
}
#portal-charge-bar-container {
    position: absolute;
    top: -25px; /* Position it above the HP bar */
    left: 0;
    width: 100%;
    height: 8px;
    background-color: #2c3e50; /* Dark background */
    border: 1px solid black;
    border-radius: 3px;
    display: none; /* Hide it by default */
    z-index: 11;
}

#portal-charge-bar-fill {
    height: 100%;
    width: 0%; /* Start at 0% */
    background-color: #9b59b6; /* A magical purple color */
    border-radius: 2px;
}

.ground {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 168px;
    background-color: transparent;
    background-repeat: repeat-x;
    z-index: 5;
}
.platform {
    position: absolute;
    height: 20px;
    background-color: transparent;
    border: none;
    z-index: 5;
}
#ui-container {
    position: absolute;
    bottom: 5px; /* Reverted back to original position */
    left: 0;
    width: 100%;
    z-index: 100;
    display: none;
}
#skill-hotbar {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    position: absolute;
    bottom: 125px; /* Moved higher up to avoid obscuring content */
    right: 10px; /* Positioned against the right side */
    z-index: 101;
    background: var(--ui-bg);
    border: 2px solid var(--ui-border);
    border-radius: 8px;
    padding: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.hotbar-row {
    display: flex;
    justify-content: center;
    gap: 8px;
}

/* Gamepad mode: single row with larger slots */
.hotbar-gamepad-mode {
    gap: 12px;
}

.hotbar-gamepad-mode .skill-slot {
    width: 50px;
    height: 50px;
}

.hotbar-gamepad-mode .hotkey-num {
    font-size: var(--font-small);
    font-weight: bold;
    background: rgba(0, 0, 0, 0.7);
    padding: 2px 4px;
    border-radius: 3px;
}

/* Drag and Drop Styles */
.hotbar-drop-zone {
    transition: all 0.2s ease;
}

.hotbar-drop-zone.drag-over {
    background-color: rgba(255, 255, 255, 0.2);
    border: 2px dashed #fff;
    transform: scale(1.05);
}

.skill-slot[draggable="true"] {
    cursor: grab;
}

.skill-slot[draggable="true"]:active {
    cursor: grabbing;
}

.inventory-slot[draggable="true"] {
    cursor: grab;
}

.inventory-slot[draggable="true"]:active {
    cursor: grabbing;
}

.skill-node[draggable="true"] {
    cursor: grab;
}

.skill-node[draggable="true"]:active {
    cursor: grabbing;
}
#main-ui-bar {
    background: var(--ui-bg);
    border-top: 2px solid var(--ui-border);
    padding: 5px;
    box-sizing: border-box;
    font-size: var(--font-standard);
}
#ui-layout {
    display: grid;
    grid-template-columns: 80px auto 1fr auto auto;
    gap: 10px;
    align-items: center;
}

#player-info-ui {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 4px;
    padding: 0 10px;
    text-align: left;
    white-space: nowrap;
}

#player-name-ui {
    font-size: var(--font-header);
    font-weight: bold;
    color: var(--exp-color);
    text-shadow: 1px 1px #000;
}

#player-class-ui {
    font-size: var(--font-large);
    color: #fff;
    text-shadow: 1px 1px #000;
}
#player-portrait {
    width: 64px;
    height: 64px;
    margin-left: 15px;
    background: #1c2833;
    border: 2px solid var(--ui-border);
    position: relative;
    /* Add these three lines to center the icon */
    display: flex;
    align-items: center;
    justify-content: center;
}
#player-level-ui {
    position: absolute;
    bottom: -12px;
    left: -2px;
    background: #000;
    border: 2px solid var(--ui-border);
    border-top-right-radius: 5px;
    padding: 4px 8px;
    font-size: var(--font-small);
    font-family: 'Ari9500';
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 6px;

}
#player-buff-effects {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* Allows clicks to pass through */
    z-index: 12; /* On top of the player sprite */
}
#player-buff-effects svg {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: visible; /* Allows effects to draw outside the box */
}
@keyframes buff-pulse {
    0% { opacity: 0.8; transform: scale(0.95); }
    50% { opacity: 0.4; transform: scale(1.05); }
    100% { opacity: 0.8; transform: scale(0.95); }
}
@keyframes buff-swirl {
    from { transform: rotate(0deg) scale(1.1); }
    to { transform: rotate(360deg) scale(1.1); }
}
.iron-will-effect {
    animation: buff-pulse 2s infinite ease-in-out;
}
.haste-effect {
    animation: buff-swirl 1.5s linear infinite;
}
.ui-bar {
    background: var(--bar-bg);
    border: 1px solid #000;
    border-radius: 5px;
    height: 15px;
    margin-bottom: 5px;
    margin-top: 5px;
    position: relative;
    overflow: hidden;
    width: 100%;
}
.ui-bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.2s ease-out;
}
.ui-bar-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-shadow: 1px 1px #000;
    width: 100%;
    text-align: center;
    font-size: var(--font-standard);
    font-weight: bold;
}

/* HP and MP bars - twice as thick as EXP bar */
#hp-bar {
    height: 24px;

}
#mp-bar {
    height: 16px;
}
#hp-bar .ui-bar-fill { background: var(--hp-color); }
#mp-bar .ui-bar-fill { background: var(--mp-color); }

/* EXP bar - standard thickness with interval markers */
#exp-bar {
    height: 8px;
}
#exp-bar .ui-bar-fill { background: var(--exp-color); }

/* EXP bar interval lines - exactly 1 pixel thick */
#exp-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
        linear-gradient(90deg, transparent calc(10% - 0.5px), rgba(0,0,0,0.4) calc(10% - 0.5px), rgba(0,0,0,0.4) calc(10% + 0.5px), transparent calc(10% + 0.5px)),
        linear-gradient(90deg, transparent calc(20% - 0.5px), rgba(0,0,0,0.4) calc(20% - 0.5px), rgba(0,0,0,0.4) calc(20% + 0.5px), transparent calc(20% + 0.5px)),
        linear-gradient(90deg, transparent calc(30% - 0.5px), rgba(0,0,0,0.4) calc(30% - 0.5px), rgba(0,0,0,0.4) calc(30% + 0.5px), transparent calc(30% + 0.5px)),
        linear-gradient(90deg, transparent calc(40% - 0.5px), rgba(0,0,0,0.4) calc(40% - 0.5px), rgba(0,0,0,0.4) calc(40% + 0.5px), transparent calc(40% + 0.5px)),
        linear-gradient(90deg, transparent calc(50% - 0.5px), rgba(0,0,0,0.6) calc(50% - 0.5px), rgba(0,0,0,0.6) calc(50% + 0.5px), transparent calc(50% + 0.5px)),
        linear-gradient(90deg, transparent calc(60% - 0.5px), rgba(0,0,0,0.4) calc(60% - 0.5px), rgba(0,0,0,0.4) calc(60% + 0.5px), transparent calc(60% + 0.5px)),
        linear-gradient(90deg, transparent calc(70% - 0.5px), rgba(0,0,0,0.4) calc(70% - 0.5px), rgba(0,0,0,0.4) calc(70% + 0.5px), transparent calc(70% + 0.5px)),
        linear-gradient(90deg, transparent calc(80% - 0.5px), rgba(0,0,0,0.4) calc(80% - 0.5px), rgba(0,0,0,0.4) calc(80% + 0.5px), transparent calc(80% + 0.5px)),
        linear-gradient(90deg, transparent calc(90% - 0.5px), rgba(0,0,0,0.4) calc(90% - 0.5px), rgba(0,0,0,0.4) calc(90% + 0.5px), transparent calc(90% + 0.5px));
    pointer-events: none;
    border-radius: 4px;
}

/* EXP text display below the bar */
.exp-info {
    font-family: var(--ui-font);
    font-size: var(--font-standard);
    color: white;
    text-align: center;
    margin-top: 2px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
}

#main-hotkey-bar {
    display: flex;
    flex-direction: row;
    gap: 6px;
    align-items: stretch;
}
.hotkey {
    position: relative;
    border: 2px solid var(--ui-border);
    background: #34495e;
    padding: 8px 12px;
    border-radius: 6px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: var(--ui-font);
    font-size: var(--font-small);
    color: white;
    font-weight: bold;
    outline: none;
    min-width: 80px;
    white-space: nowrap;
}

.hotkey:hover {
    background: #4a6380;
    border-color: #5a7395;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.hotkey:active {
    background: #2c3e50;
    transform: translateY(0);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
}

/* Special styling for the settings gear button */
.hotkey.settings-btn {
    background: #444;
    border-color: #666;
    font-size: var(--font-standard);
    min-width: 60px;
    padding: 6px 10px;
}

.hotkey.settings-btn:hover {
    background: #555;
    border-color: #777;
}

.skill-slot {
    width: 48px;
    height: 48px;
    border: 2px solid #888;
    background-color: #333;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}
.skill-slot svg { 
    width: 100%; height: 100%; 
}
.skill-slot .hotkey-num {
    position: absolute;
    top: 2px;
    right: 2px;
    font-size: var(--font-small);
    font-family: 'Ari9500';
    font-weight: bold;
    text-shadow: 1px 1px #000;
    background: rgba(0, 0, 0, 0.7);
    padding: 2px 4px;
    border-radius: 3px;
}
.skill-slot .item-quantity-top-left {
    position: absolute;
    bottom: 2px;
    left: 2px;
    font-size: var(--font-small);
    font-family: 'Ari9500';
    font-weight: bold;
    text-shadow: 1px 1px #000;
}
#notification-container {
    position: absolute;
    bottom: 260px;
    right: 10px;
    z-index: 102;
    pointer-events: none;
    display: flex;
    flex-direction: column-reverse;
    align-items: flex-end;
    gap: 4px;
}

/* Adjust notification position for gamepad mode (single row hotbar) */
body.gamepad-active #notification-container {
    bottom: 200px;
}

/* Gamepad Hotbar Assignment Menu */
#gamepad-hotbar-menu-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 10002; /* Between windows (10002) and menu (10003) */
    pointer-events: auto; /* Block all clicks to elements behind */
}

#gamepad-hotbar-menu {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 20, 30, 0.98);
    border: 3px solid #4a90e2;
    border-radius: 12px;
    padding: 20px;
    z-index: 10003; /* Above all windows (10002) and backdrop */
    min-width: 400px;
    box-shadow: 0 0 30px rgba(74, 144, 226, 0.5);
    pointer-events: auto; /* Ensure menu blocks clicks to elements behind it */
}

.hotbar-menu-header {
    font-size: var(--font-standard);
    font-weight: bold;
    color: #4a90e2;
    text-align: center;
    margin-bottom: 15px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
}

#hotbar-menu-slots {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 15px;
}

.hotbar-menu-slot {
    background: rgba(40, 40, 50, 0.9);
    border: 3px solid #666;
    border-radius: 10px;
    padding: 12px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    position: relative;
    min-height: 140px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    user-select: none;
}

.hotbar-menu-slot:hover,
.hotbar-menu-slot.selected {
    background: rgba(74, 144, 226, 0.4);
    border-color: #4a90e2;
    transform: scale(1.08);
    box-shadow: 0 0 20px rgba(74, 144, 226, 0.6);
}

.hotbar-menu-slot-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.hotbar-menu-slot-number {
    font-size: var(--font-standard);
    font-weight: bold;
    color: #4a90e2;
}

.hotbar-menu-slot-button {
    font-size: var(--font-standard);
    font-weight: bold;
    color: #ffd700;
    background: rgba(0, 0, 0, 0.4);
    padding: 2px 8px;
    border-radius: 4px;
    border: 1px solid #ffd700;
}

.hotbar-menu-slot-icon {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 48px;
    margin: 8px 0;
}

.hotbar-menu-slot-current {
    font-size: var(--font-small);
    color: #ccc;
    margin-top: 8px;
    min-height: 20px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.hotbar-menu-footer {
    font-size: var(--font-standard);
    color: #999;
    text-align: center;
    margin-top: 10px;
}

.notification-text {
    position: relative;
    font-size: var(--font-standard);
    font-weight: bold;
    text-shadow: 1px 1px #000;
    animation: notificationSlideIn 0.2s ease-out, notificationFadeOut 2s 0.3s forwards;
    white-space: nowrap;
    opacity: 1;
}

@keyframes notificationSlideIn {
    from {
        transform: translateX(20px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes notificationFadeOut {
    0% { opacity: 1; transform: translateY(0); }
    70% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-10px); }
}
.notification-text.exp { color: var(--exp-color); }
.notification-text.partyExp { color: #3498db; }
.notification-text.eventExp { color: #e74c3c; text-shadow: 0 0 10px rgba(231, 76, 60, 0.5); }
.notification-text.common { color: var(--common-color); }
.notification-text.rare { color: var(--rare-color); }
.notification-text.epic { color: var(--epic-color); }
.notification-text.legendary { color: var(--legendary-color); }
.notification-text.cosmetic { color: var(--cosmetic-color); }
.notification-text.quest { color: var(--quest-color); }
.notification-text.error { color: red; }
.notification-text.success { color: var(--success-color); font-weight: bold; }
.notification-text.fail { color: var(--fail-color); font-weight: bold; }
.notification-text.destroyed { color: var(--destroy-color); font-weight: bold; font-size: var(--font-standard); animation: shake 0.5s, notificationFadeOut 2s forwards; }

.monster, .npc { position: absolute; z-index: 9; will-change: transform; }
.monster.mini-boss {
    transform: scale(1.5);
    filter: drop-shadow(0 0 5px red);
}

/* Trial Boss Player Sprite Styles */
.monster.trial-boss-player {
    overflow: visible;
}
.monster.trial-boss-player canvas {
    image-rendering: pixelated;
    image-rendering: crisp-edges;
}
.monster.trial-boss-player .monster-nameplate {
    top: 68px; /* Position below player sprite */
    color: #ff6b6b; /* Red tint to indicate hostile */
    text-shadow: 1px 1px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000;
}

.monster-hp-bar-container {
    position: absolute;
    width: 100%;
    height: 5px;
    background-color: #333;
    border: 1px solid black;
    top: -10px;
    display: none;
}
.monster-hp-bar-fill {
    height: 100%;
    background-color: var(--hp-color);
    transition: width 0.2s linear;
}

/* Elite Monster Styles */
.elite-monster {
    animation: eliteGlow 2s ease-in-out infinite;
    filter: drop-shadow(0 0 5px #ffd700) brightness(1.3);
}

@keyframes eliteGlow {
    0%, 100% {
        filter: drop-shadow(0 0 5px #ffd700) drop-shadow(0 0 25px #ff8c00) brightness(1.3);
    }
    50% {
        filter: drop-shadow(0 0 7px #ffd700) drop-shadow(0 0 35px #ff8c00) brightness(1.5);
    }
}

#mini-boss-hp-bar {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    background: linear-gradient(135deg, rgba(40, 20, 20, 0.95), rgba(50, 30, 30, 0.95));
    padding: 15px 30px;
    border-radius: 10px;
    border: 3px solid #dc143c;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.7);
    min-width: 500px;
    text-align: center;
}

.mini-boss-name {
    font-family: 'Ari9500', monospace;
    font-size: 20px;
    font-weight: bold;
    color: #dc143c;
    text-shadow: 2px 2px 4px #000;
    margin-bottom: 8px;
    letter-spacing: 2px;
}

.mini-boss-hp-bar-container {
    width: 100%;
    height: 22px;
    background: linear-gradient(to bottom, #1a1a1a, #0d0d0d);
    border: 2px solid #dc143c;
    border-radius: 5px;
    overflow: hidden;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
    margin-bottom: 5px;
}

.mini-boss-hp-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #8b0000, #dc143c, #ff4500);
    transition: width 0.3s ease;
}

.mini-boss-hp-text {
    font-family: 'Ari9500', monospace;
    font-size: 13px;
    color: #fff;
    text-shadow: 1px 1px 2px #000;
}

#elite-monster-hp-bar {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9998;
    background: linear-gradient(135deg, rgba(20, 20, 30, 0.95), rgba(30, 30, 40, 0.95));
    padding: 15px 25px;
    border-radius: 10px;
    border: 3px solid #ffd700;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.6), 0 4px 15px rgba(0, 0, 0, 0.7);
    min-width: 400px;
    text-align: center;
}

.elite-monster-name {
    font-family: 'Ari9500', monospace;
    font-size: 18px;
    font-weight: bold;
    color: #ffd700;
    text-shadow: 2px 2px 4px #000, 0 0 10px #ff8c00;
    margin-bottom: 8px;
    letter-spacing: 2px;
}

.elite-monster-hp-bar-container {
    width: 100%;
    height: 20px;
    background: linear-gradient(to bottom, #1a1a1a, #0d0d0d);
    border: 2px solid #ffd700;
    border-radius: 5px;
    overflow: hidden;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
    margin-bottom: 5px;
}

.elite-monster-hp-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #ff0000, #ff4500, #ffd700);
    transition: width 0.3s ease;
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
    animation: hpBarPulse 2s ease-in-out infinite;
}

@keyframes hpBarPulse {
    0%, 100% {
        filter: brightness(1);
    }
    50% {
        filter: brightness(1.3);
    }
}

.elite-monster-hp-text {
    font-family: 'Ari9500', monospace;
    font-size: 12px;
    color: #fff;
    text-shadow: 1px 1px 2px #000;
}

/* World Boss Event UI */
#world-boss-ui {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    background: linear-gradient(135deg, rgba(75, 0, 130, 0.95), rgba(30, 0, 60, 0.95));
    padding: 15px 25px;
    border-radius: 12px;
    border: 3px solid #9b59b6;
    box-shadow: 0 0 30px rgba(155, 89, 182, 0.8), 0 4px 20px rgba(0, 0, 0, 0.8);
    min-width: 450px;
    text-align: center;
    animation: worldBossAppear 0.5s ease-out;
}

#world-boss-ui.ending {
    animation: worldBossDisappear 2s ease-out forwards;
}

@keyframes worldBossAppear {
    from {
        transform: translateX(-50%) translateY(-100px);
        opacity: 0;
    }
    to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }
}

@keyframes worldBossDisappear {
    to {
        transform: translateX(-50%) translateY(-100px);
        opacity: 0;
    }
}

.world-boss-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 10px;
}

.world-boss-icon {
    font-size: 28px;
    filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
}

.world-boss-name {
    font-family: 'Ari9500', monospace;
    font-size: 20px;
    font-weight: bold;
    color: #fff;
    text-shadow: 2px 2px 4px #000, 0 0 15px #9b59b6;
    letter-spacing: 2px;
}

.world-boss-timer {
    font-family: 'Ari9500', monospace;
    font-size: 16px;
    color: #f1c40f;
    background: rgba(0, 0, 0, 0.5);
    padding: 4px 10px;
    border-radius: 4px;
    text-shadow: 1px 1px 2px #000;
}

.world-boss-hp-container {
    width: 100%;
    height: 24px;
    background: linear-gradient(to bottom, #1a1a1a, #0d0d0d);
    border: 2px solid #9b59b6;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
    margin-bottom: 6px;
}

.world-boss-hp-bar {
    height: 100%;
    background: linear-gradient(90deg, #e74c3c, #9b59b6, #3498db);
    transition: width 0.3s ease;
    box-shadow: 0 0 15px rgba(155, 89, 182, 0.8);
    animation: worldBossHpPulse 1.5s ease-in-out infinite;
}

@keyframes worldBossHpPulse {
    0%, 100% {
        filter: brightness(1);
    }
    50% {
        filter: brightness(1.4);
    }
}

.world-boss-hp-text {
    font-family: 'Ari9500', monospace;
    font-size: 13px;
    color: #fff;
    text-shadow: 1px 1px 2px #000;
    margin-bottom: 8px;
}

.world-boss-contribution {
    font-family: 'Ari9500', monospace;
    font-size: 11px;
    color: #bdc3c7;
    margin-bottom: 10px;
}

.world-boss-contribution span {
    color: #2ecc71;
    font-weight: bold;
}

.world-boss-attack-btn {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    border: 2px solid #fff;
    color: #fff;
    padding: 10px 25px;
    border-radius: 6px;
    font-family: 'Ari9500', monospace;
    font-size: 14px;
    cursor: pointer;
    text-shadow: 1px 1px 2px #000;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
    transition: all 0.2s;
}

.world-boss-attack-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(231, 76, 60, 0.6);
}

.world-boss-attack-btn:active {
    transform: scale(0.95);
}

.world-boss-damage-number {
    position: absolute;
    font-family: 'Ari9500', monospace;
    font-size: 18px;
    font-weight: bold;
    color: #fff;
    text-shadow: 2px 2px 4px #000;
    pointer-events: none;
    animation: damageFloat 1s ease-out forwards;
    top: 50%;
}

.world-boss-damage-number.crit {
    font-size: 24px;
    color: #f1c40f;
    text-shadow: 2px 2px 4px #000, 0 0 10px #ff8c00;
}

@keyframes damageFloat {
    from {
        opacity: 1;
        transform: translateY(0);
    }
    to {
        opacity: 0;
        transform: translateY(-50px);
    }
}

.world-boss-instructions {
    font-family: 'Ari9500', monospace;
    font-size: 11px;
    color: #f39c12;
    margin-top: 5px;
}

/* World Boss Warp Prompt */
#world-boss-warp-prompt {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 99999;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.world-boss-prompt-content {
    background: linear-gradient(135deg, rgba(75, 0, 130, 0.98), rgba(30, 0, 60, 0.98));
    padding: 30px 50px;
    border-radius: 15px;
    border: 4px solid #9b59b6;
    box-shadow: 0 0 60px rgba(155, 89, 182, 0.9), 0 0 100px rgba(255, 0, 100, 0.4);
    text-align: center;
    max-width: 500px;
    animation: promptPulse 2s ease-in-out infinite;
}

@keyframes promptPulse {
    0%, 100% { box-shadow: 0 0 60px rgba(155, 89, 182, 0.9), 0 0 100px rgba(255, 0, 100, 0.4); }
    50% { box-shadow: 0 0 80px rgba(155, 89, 182, 1), 0 0 120px rgba(255, 0, 100, 0.6); }
}

.world-boss-prompt-icon {
    font-size: 72px;
    display: block;
    margin-bottom: 15px;
    animation: iconBounce 1s ease-in-out infinite;
}

@keyframes iconBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.world-boss-prompt-title {
    font-family: 'Ari9500', monospace;
    font-size: 24px;
    color: #f1c40f;
    text-shadow: 2px 2px 4px #000, 0 0 20px #f39c12;
    margin-bottom: 10px;
    letter-spacing: 3px;
    animation: alertFlash 0.5s ease-in-out infinite alternate;
}

@keyframes alertFlash {
    from { color: #f1c40f; }
    to { color: #e74c3c; }
}

.world-boss-prompt-name {
    font-family: 'Ari9500', monospace;
    font-size: 32px;
    color: #fff;
    text-shadow: 2px 2px 4px #000, 0 0 15px #9b59b6;
    margin-bottom: 15px;
}

.world-boss-prompt-desc {
    font-family: 'Ari9500', monospace;
    font-size: 14px;
    color: #bdc3c7;
    margin-bottom: 15px;
    line-height: 1.4;
}

.world-boss-prompt-warning {
    font-family: 'Ari9500', monospace;
    font-size: 12px;
    color: #f39c12;
    background: rgba(0, 0, 0, 0.4);
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 20px;
}

.world-boss-prompt-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-bottom: 15px;
}

.world-boss-join-btn {
    background: linear-gradient(135deg, #27ae60, #1e8449);
    border: 3px solid #fff;
    color: #fff;
    padding: 15px 35px;
    border-radius: 8px;
    font-family: 'Ari9500', monospace;
    font-size: 18px;
    cursor: pointer;
    text-shadow: 1px 1px 2px #000;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    transition: all 0.2s;
}

.world-boss-join-btn:hover {
    transform: scale(1.08);
    box-shadow: 0 0 30px rgba(46, 204, 113, 0.7);
}

.world-boss-decline-btn {
    background: linear-gradient(135deg, #7f8c8d, #555);
    border: 2px solid #bdc3c7;
    color: #fff;
    padding: 12px 25px;
    border-radius: 8px;
    font-family: 'Ari9500', monospace;
    font-size: 14px;
    cursor: pointer;
    text-shadow: 1px 1px 2px #000;
    transition: all 0.2s;
}

.world-boss-decline-btn:hover {
    background: linear-gradient(135deg, #95a5a6, #777);
}

.world-boss-prompt-timer {
    font-family: 'Ari9500', monospace;
    font-size: 14px;
    color: #e74c3c;
}

.world-boss-prompt-timer span {
    color: #f1c40f;
    font-weight: bold;
    font-size: 18px;
}

/* World Boss Monster (in-arena sprite) */
.world-boss-monster {
    animation: worldBossIdle 2s ease-in-out infinite;
    transition: transform 0.1s;
}

@keyframes worldBossIdle {
    0%, 100% {
        transform: translateY(0) scale(1);
    }
    50% {
        transform: translateY(-10px) scale(1.02);
    }
}

.world-boss-monster.hit {
    animation: worldBossHit 0.2s ease-out;
}

@keyframes worldBossHit {
    0%, 100% {
        filter: drop-shadow(0 0 20px rgba(255, 50, 50, 0.8));
    }
    50% {
        filter: drop-shadow(0 0 40px rgba(255, 255, 255, 1)) brightness(2);
    }
}

.world-boss-nameplate {
    font-family: 'Ari9500', monospace;
    text-align: center;
    z-index: 101;
}

/* World Boss AoE Attack Zones */
.world-boss-aoe-zone {
    box-shadow: 0 0 20px rgba(255, 0, 0, 0.5), inset 0 0 30px rgba(255, 0, 0, 0.3);
}

@keyframes aoeWarningPulse {
    0%, 100% {
        transform: scale(1);
        opacity: 0.8;
    }
    50% {
        transform: scale(1.05);
        opacity: 1;
    }
}

@keyframes aoeExplosion {
    0% {
        transform: scale(0.8);
        opacity: 1;
    }
    50% {
        transform: scale(1.3);
        opacity: 0.8;
    }
    100% {
        transform: scale(1.5);
        opacity: 0;
    }
}

/* Animation for notification text - fade out without moving position */
@keyframes notificationFadeOut {
    0% {
        opacity: 1;
    }
    70% {
        opacity: 1;
    }
    100% {
        opacity: 0;
    }
}

@keyframes floatUp {
    0% {
        transform: translateY(0);
        opacity: 1;
    }
    100% {
        transform: translateY(-60px);
        opacity: 0;
    }
}

.floating-damage {
    font-family: 'Ari9500', monospace;
    animation: floatUp 1s ease-out forwards;
}

/* Rescue System UI */
#downed-ui {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10000;
    background: linear-gradient(135deg, rgba(139, 0, 0, 0.95), rgba(60, 0, 0, 0.95));
    padding: 25px 40px;
    border-radius: 15px;
    border: 3px solid #e74c3c;
    box-shadow: 0 0 40px rgba(231, 76, 60, 0.8), 0 8px 25px rgba(0, 0, 0, 0.8);
    text-align: center;
    animation: downedPulse 1s ease-in-out infinite;
}

@keyframes downedPulse {
    0%, 100% {
        box-shadow: 0 0 40px rgba(231, 76, 60, 0.8), 0 8px 25px rgba(0, 0, 0, 0.8);
    }
    50% {
        box-shadow: 0 0 60px rgba(231, 76, 60, 1), 0 8px 25px rgba(0, 0, 0, 0.8);
    }
}

.downed-header {
    font-family: 'Ari9500', monospace;
    font-size: 28px;
    font-weight: bold;
    color: #fff;
    text-shadow: 2px 2px 4px #000, 0 0 15px #e74c3c;
    margin-bottom: 10px;
}

.downed-subtext {
    font-family: 'Ari9500', monospace;
    font-size: 14px;
    color: #bdc3c7;
    margin-bottom: 15px;
}

.downed-timer-container {
    width: 100%;
    height: 12px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 10px;
}

.downed-timer-bar {
    height: 100%;
    background: linear-gradient(90deg, #2ecc71, #f1c40f, #e74c3c);
    transition: width 0.1s linear;
}

.downed-timer-text {
    font-family: 'Ari9500', monospace;
    font-size: 12px;
    color: #f1c40f;
}

/* Rescue Progress UI */
#rescue-progress-ui {
    position: fixed;
    bottom: 150px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    background: rgba(46, 204, 113, 0.9);
    padding: 12px 25px;
    border-radius: 8px;
    border: 2px solid #27ae60;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    text-align: center;
}

.rescue-progress-text {
    font-family: 'Ari9500', monospace;
    font-size: 14px;
    color: #fff;
    text-shadow: 1px 1px 2px #000;
    margin-bottom: 8px;
}

.rescue-progress-bar-container {
    width: 200px;
    height: 8px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 4px;
    overflow: hidden;
}

.rescue-progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #fff, #2ecc71);
    border-radius: 4px;
}

/* Downed Player Indicator (shown on other players' screens) */
.downed-player-indicator {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(231, 76, 60, 0.9);
    padding: 4px 10px;
    border-radius: 4px;
    font-family: 'Ari9500', monospace;
    font-size: 10px;
    color: #fff;
    white-space: nowrap;
    animation: downedIndicatorPulse 0.5s ease-in-out infinite;
    cursor: pointer;
}

@keyframes downedIndicatorPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

.rescue-button {
    background: linear-gradient(135deg, #2ecc71, #27ae60);
    border: none;
    color: #fff;
    padding: 4px 12px;
    border-radius: 4px;
    font-family: 'Ari9500', monospace;
    font-size: 11px;
    cursor: pointer;
    margin-left: 8px;
    transition: transform 0.2s;
}

.rescue-button:hover {
    transform: scale(1.1);
}

.attack-box { 
    position: absolute; 
    z-index: 10;
    pointer-events: none;
    background: rgba(255, 255, 100, 0.3);
    border: 1px solid rgba(255, 255, 100, 0.7);
    border-radius: 5px;
    animation: attack-fade 0.1s forwards;
}
@keyframes attack-fade {
    from { opacity: 1; }
    to { opacity: 0; }
}
.projectile {
    position: absolute;
    z-index: 10;
    pointer-events: none;
}
.item-drop { 
    position: absolute; 
    width: 24px; 
    height: 24px; 
    z-index: 8; 
}
.portal {
    position: absolute;
    z-index: 7;
    pointer-events: none; /* Prevents portal from blocking clicks on things behind it */
}
.portal-label {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    color: yellow;
    font-size: var(--font-standard);
    text-shadow: 1px 1px #000;
    white-space: nowrap;
}

@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

.scenery {
    position: absolute;
    z-index: 1;
    /* In front of player (10) and foreground foliage (11) */
    pointer-events: none;
    /* So it doesn't block clicks */
}
.damage-number {
    position: absolute;
    font-size: 16px; /* Fallback for browsers without CSS variable support */
    font-size: var(--font-standard, 16px);
    font-weight: bold;
    font-family: 'Ari9500', Arial, sans-serif;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    animation: floatUp 1s forwards;
    -webkit-animation: floatUp 1s forwards;
    pointer-events: none;
    z-index: 101;
    white-space: nowrap;
}
.damage-number.player { 
    color: red; 
}
.damage-number.monster { 
    color: yellow; 
}
.damage-number.critical {
    color: #ff8800;
    font-size: 24px; /* Fallback */
    font-size: var(--font-large, 24px);
    font-weight: bold;
    font-family: 'Ari9500', Arial, sans-serif;
    animation: floatUp 0.5s forwards;
    -webkit-animation: floatUp 0.5s forwards;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                 0 0 4px #ff8800, 0 0 8px #ff8800;
}
.damage-number.miss {
    color: #95a5a6;
    /* A grey color for misses */
    font-size: 16px; /* Fallback */
    font-size: var(--font-standard, 16px);
}
.damage-number.shadow-partner {
    color: #9b59b6;
    /* Purple color for shadow partner damage */
    font-size: 14px;
    font-size: var(--font-small, 14px);
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                 0 0 4px #9b59b6, 0 0 6px #6c3483;
}

@keyframes floatUp { from { transform: translateY(0); opacity: 1; } to { transform: translateY(-40px); opacity: 0; } }
@-webkit-keyframes floatUp { from { -webkit-transform: translateY(0); opacity: 1; } to { -webkit-transform: translateY(-40px); opacity: 0; } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
@keyframes critical-pop {
    0% { transform: scale(2) rotate(-5deg); opacity: 0.8; }
    25% { transform: scale(1.8) rotate(5deg); opacity: 1; }
    50% { transform: scale(1.5) rotate(-3deg); opacity: 1; }
    75% { transform: scale(1.3) rotate(3deg); opacity: 1; }
    100% { transform: scale(1.2) rotate(0deg); opacity: 1; }
}
@keyframes lootPulse {
    0% { 
        transform: scale(0.8); 
        opacity: 1; 
    }
    50% { 
        transform: scale(1.2); 
        opacity: 0.8; 
    }
    100% { 
        transform: scale(0.5); 
        opacity: 0; 
    }
}
#inventory .window-content {
    overflow: hidden;
}
.window-content button {
     padding: 8px 16px; border: 1px solid #fff; background-color: #555;
    color: #fff; font-family: 'Ari9500'; cursor: pointer;
    margin-top: 8px; box-shadow: 1px 1px #000; font-size: var(--font-standard);
    border-radius: 2px;
}
.window-content button:hover { 
    background-color: #777; 
}
.window-content button:disabled { 
    background-color: #333; color: #888; cursor: not-allowed; 
}

#inventory-grid {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 4px;
    max-height: 320px;
    /* (6 rows * 45px slot) + (5 * 4px gap) */
    overflow-y: auto;
    overflow-x: hidden;
    /* Prevent horizontal scrolling */
    padding-right: 5px;
    /* Prevent scrollbar from overlapping content */
    box-sizing: border-box;
    position: relative !important;
}

/* =============================================== */
/* ==       FIX FOR UNRESPONSIVE UI BUTTONS     == */
/* =============================================== */

/*
  This rule disables any potential invisible overlays on the item grid
  that could be stealing mouse clicks from the item slots.
*/
#inventory-grid::before,
#inventory-grid::after {
    display: none !important;
    pointer-events: none !important;
}

/*
  This rule forcefully ensures that the inventory tabs and the individual
  item slots are always able to be clicked, overriding any other
  style that might be disabling them.
*/
#inventory-tabs .tab-btn,
#inventory-grid .inventory-slot {
    pointer-events: auto !important;
}

.window {
    position: absolute;
    background-color: var(--ui-bg);
    border: 2px solid var(--ui-border);
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    display: none;
    z-index: 10002;
    font-size: var(--font-standard);
    will-change: transform;
    max-width: calc(100vw - 40px);
    max-height: calc(100vh - 40px);
    overflow: hidden;
}

/* Responsive window scaling */
@media (max-width: 1366px) {
    .window {
        font-size: var(--font-standard);
    }
}

@media (max-width: 1024px) {
    .window {
        font-size: var(--font-small);
        max-width: calc(100vw - 20px);
        max-height: calc(100vh - 20px);
    }
}

@media (max-width: 768px) {
    .window {
        font-size: var(--font-small);
        max-width: calc(100vw - 10px);
        max-height: calc(100vh - 10px);
    }
}

/* Ultra-wide screen support */
@media (min-aspect-ratio: 21/9) {
    #game-container {
        background: radial-gradient(ellipse at center, #111 0%, #000 70%);
    }
}

/* Very narrow screens */
@media (max-aspect-ratio: 4/3) {
    #scaling-container {
        /* Allow more aggressive scaling on very narrow screens */
        max-width: 95vw;
    }
}

/* High DPI display optimization */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .pixel-art, canvas, img {
        image-rendering: pixelated;
        -ms-interpolation-mode: nearest-neighbor;
    }
}
.window-title {
    background: var(--ui-border);
    color: #141e28;
    padding: 6px 8px;
    border-top-left-radius: 2px;
    border-top-right-radius: 2px;
    cursor: grab;
    margin: 0;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: var(--font-header);
    font-weight: bold;
}

.close-btn {
    background: #cc5555;
    color: white;
    border: 1px solid #aa3333;
    padding: 4px 8px;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    cursor: pointer;
    border-radius: 2px;
    box-shadow: 1px 1px #993333;
}

.close-btn:hover {
    background: #dd6666;
    border-color: #bb4444;
}
.window-content {
    padding: 8px;
    overflow: hidden; /* Prevents scrollbars */
    flex-grow:1;
    font-size: var(--font-standard);
    line-height: 1.3;
}

.window-content h3 {
    font-size: var(--font-standard);
    margin: 10px 0 8px 0;
    color: var(--exp-color);
    border-bottom: 1px solid rgba(160, 176, 192, 0.3);
    padding-bottom: 4px;
}

.window-content h4 {
    font-size: var(--font-standard);
    margin: 8px 0 6px 0;
    color: #ecf0f1;
}
#inventory {
    width: 450px;
    height: auto;
    min-height: 320px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}
#equipment { 
    width: 420px; 
    top: 20px; 
    left: 20px; 
}
#stat-window { 
    width: 300px;
    top: 20px; 
    left: 450px;
}
#skill-tree { 
    width: 380px;
    top: 300px;
    left: 350px;
}
#quest-log { 
    top: 150px; 
    left: 480px;
    width: 480px;
    height: 520px;
    transform: none;
}

/* Only apply flex layout when window is visible */
#quest-log[style*="display: block"],
#quest-log[style*="display: flex"] {
    display: flex !important;
    flex-direction: column;
}

#quest-log .window-content {
    flex: 1;
    overflow-y: auto;
    min-height: 0;
}

#quest-log-footer {
    flex-shrink: 0;
    padding: 10px 5px;
    border-top: 1px solid var(--ui-border);
    text-align: center;
    background: rgba(0, 0, 0, 0.3);
}

/* Quest Tab Specific Styles */
.quest-tabs {
    display: flex;
    margin-bottom: 10px;
    border-bottom: 2px solid var(--ui-border);
    flex-shrink: 0; /* Prevent tabs from shrinking */
}

.quest-tab-button {
    flex: 1;
    padding: 6px;
    background: #34495e;
    color: #ecf0f1;
    border: none;
    cursor: pointer;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    border-right: 1px solid var(--ui-border);
}

.quest-tab-button:last-child {
    border-right: none;
}

.quest-tab-button.active {
    background: var(--ui-border);
    color: #141e28;
}

.quest-tab-button:hover:not(.active) {
    background: #4a6741;
}

.quest-tab-content {
    display: none;
    padding-right: 10px;
    margin-right: -5px;
    padding-bottom: 10px;
}

.quest-tab-content.active {
    display: block;
}

/* Quest Item Styles */
.quest-item {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #444;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
}

.quest-item.available {
    border-left: 4px solid var(--common-color);
}

.quest-item.active {
    border-left: 4px solid var(--exp-color);
}

.quest-item.completed {
    border-left: 4px solid var(--rare-color);
    opacity: 0.8;
}

.quest-item h4 {
    margin: 0 0 6px 0;
    color: #fff;
    font-size: var(--font-small);
}

.quest-item p {
    margin: 3px 0;
    font-size: var(--font-small);
    line-height: 1.3;
}

.quest-description {
    color: #ccc;
    font-style: italic;
}

.quest-objective {
    color: var(--exp-color);
}

.quest-reward {
    color: var(--rare-color);
}

.quest-chain {
    color: var(--legendary-color);
    font-size: var(--font-small);
}

.quest-level {
    color: var(--rare-color);
    font-size: var(--font-small);
    font-weight: bold;
}

/* Quest Count Badges */
.quest-count {
    background: var(--exp-color);
    color: #000;
    border-radius: 10px;
    padding: 2px 6px;
    font-size: var(--font-small);
    margin-left: 5px;
    display: inline-block;
    min-width: 12px;
    text-align: center;
}

/* Progress Bar for Active Quests */
.progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 4px;
    overflow: hidden;
    margin: 5px 0;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--exp-color), var(--rare-color));
    transition: width 0.3s ease;
}

.quest-tab-content::-webkit-scrollbar,
#quest-helper-content::-webkit-scrollbar {
    width: 6px;
}

.quest-tab-content::-webkit-scrollbar-track,
#quest-helper-content::-webkit-scrollbar-track {
    background: #2c3e50;
}

.quest-tab-content::-webkit-scrollbar-thumb,
#quest-helper-content::-webkit-scrollbar-thumb {
    background: var(--ui-border);
    border-radius: 3px;
}

/* Quest Helper Styles */
#quest-helper-content {
    padding: 5px;
}

.quest-helper-item {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #444;
    padding: 8px;
    margin-bottom: 8px;
    border-radius: 4px;
    border-left: 3px solid var(--exp-color);
}

.quest-helper-item h5 {
    margin: 0 0 5px 0;
    font-size: var(--font-standard);
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.quest-helper-item p {
    margin: 0;
    font-size: var(--font-small);
    color: #ccc;
}

.quest-helper-progress-bar {
    width: 100%;
    height: 6px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 3px;
    margin-top: 5px;
}

#dialogue-window {
    width: 400px;
    top: 175px;
    left: 200px;
    content: center;
    transform: none; /* FIXED: Removed transform */
}
#shop-window {
    width: 400px;
    top: 100px;
    left: 200px;
    transform: none; /* FIXED: Removed transform */
}
#settings-menu {
    width: 500px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: none;
    /* FIX: Changed from flex to grid */
    grid-template-rows: auto 1fr auto;
    /* FIX: Defines Header, Content, and Footer rows */
    max-height: 80vh;
    /* Ensure settings menu is above overlays (fade-overlay, loading screen, CRT overlays) */
    z-index: 10003;
    pointer-events: auto;
}
#settings-menu .window-title {
    flex-shrink: 0;
}
#settings-menu .window-content {
    flex: 1;
    overflow-y: auto;
    min-height: 0; /* Important for flex child with overflow */
}
#settings-footer {
    flex-shrink: 0;
}
#enhancement-confirm-modal {
    width: 400px;
    top: 200px;
    left: 200px;
    transform: none; /* FIXED: Removed transform */
}

/* --- Enhancement Window Layout --- */
.enhancement-layout {
    display: flex;
    gap: 15px;
    align-items: flex-start;
    margin-bottom: 15px;
}

.enhancement-item-display {
    flex-shrink: 0;
}

#enhancement-item-slot {
    width: 60px;
    height: 60px;
    cursor: default;
    /* Make it not look clickable */
}

#enhancement-item-slot .pixel-art {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(7.5);
}

.enhancement-stats-display {
    flex-grow: 1;
    text-align: left;
}

.enhancement-chances {
    text-align: center;
    padding-top: 10px;
    border-top: 1px solid var(--ui-border);
}

/* --- Inventory-Specific Fixes --- */
#inventory-tabs {
    display: flex;
    margin-bottom: 10px;
    border-bottom: 2px solid var(--ui-border);
}
.tab-btn {
    flex: 1;
    padding: 6px;
    background: #34495e;
    color: #ecf0f1;
    border: none;
    cursor: pointer;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    border-right: 1px solid var(--ui-border);
}
.tab-btn:last-child {
    border-right: none;
}
.tab-btn.active {
    background: var(--ui-border);
    color: #141e28;
}
.tab-btn:hover:not(.active) {
    background: #4a6741;
}

.inventory-actions {
    display: flex;
    gap: 10px;
    align-items: center;
}

/* This new rule specifically targets the buttons inside the footer */
#inventory-footer .inventory-actions button {
    margin-top: 0;
}

#inventory-footer {
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid var(--ui-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}
#inventory-gold { 
    color: var(--exp-color); 
    font-size: var(--font-header);
    font-family: 'Ari9500';
    font-weight: bold;
}
#enhance-item-btn { margin-top: 0; }
.inventory-slot {
    width: 45px; height: 45px; border: 1px solid #fff;
    background-color: #455779; cursor: pointer;
    display: flex; justify-content: center; align-items: center;
    box-sizing: border-box;
    position: relative;
}
.inventory-slot:hover,
.equip-slot:hover {
    background-color: #555;
}
.inventory-slot.selected,
.equip-slot.selected {
    border: 2px solid var(--exp-color);
}
/* --- Find these existing rules and add the new selectors --- */

.inventory-slot.rare,
.equip-slot.rare,
.gachapon-item.rare,
.gachapon-result-item.rare {
    box-shadow: 0 0 5px 2px var(--rare-color);
}

.inventory-slot.epic,
.equip-slot.epic,
.gachapon-item.epic,
.gachapon-result-item.epic {
    box-shadow: 0 0 5px 2px var(--epic-color);
}

.inventory-slot.legendary,
.equip-slot.legendary,
.gachapon-item.legendary,
.gachapon-result-item.legendary {
    box-shadow: 0 0 5px 2px var(--legendary-color);
}

.inventory-slot.quest,
.equip-slot.quest,
.gachapon-item.quest,
.gachapon-result-item.quest {
    box-shadow: 0 0 5px 2px var(--quest-color);
}

.inventory-slot.cosmetic,
.equip-slot.cosmetic,
.gachapon-item.cosmetic,
.gachapon-result-item.cosmetic {
    box-shadow: 0 0 5px 2px var(--cosmetic-color);
}
.inventory-slot .pixel-art, .equip-slot .pixel-art { 
    transform: scale(3) !important; 
    image-rendering: pixelated;
    background-size: auto !important;
    background-repeat: no-repeat !important;
}
.inventory-slot svg, .equip-slot svg { width: 25% !important; height: 25% !important; }
.item-quantity {
    position: absolute;
    bottom: 2px;
    right: 4px;
    font-size: var(--font-small);
    font-family: 'Ari9500';
    font-weight: bold;
    text-shadow: 1px 1px #000;
}

#inventory-trash-btn:hover {
    background-color: var(--hp-color);
}
#inventory-trash-btn:hover:not(:disabled) {
    background-color: var(--hp-color);
}
#equipment-layout {
    display: flex;
    justify-content: space-around;
    gap: 20px;
}
.equipment-section {
    display: flex;
    flex-direction: column;
    align-items: center;
}
.equipment-section h4 {
    margin: 0 0 10px 0;
    text-align: center;
}
#equipment-display, #cosmetic-equipment-display { 
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(4, 1fr);
    gap: 5px;
    justify-items: center;
}
.equip-slot {
    width: 45px; height: 45px; border: 1px dashed #888;
    background-color: #333;
    display: flex; justify-content: center; align-items: center;
    position: relative;
    box-sizing: border-box;
}
.equip-slot.cosmetic-slot {
     border-color: var(--cosmetic-color);
}
.equip-slot.drag-over {
    background-color: rgba(76, 175, 80, 0.3);
    border-color: #4CAF50;
    border-style: solid;
    border-width: 2px;
    box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
}
.equip-slot svg { 
    width: 25% !important; 
    height: 25% !important; 
}

#skill-tree-content { 
    margin-top: 10px; 
}

#skill-tree-tabs {
    display: flex;
    margin-bottom: 10px;
    border-bottom: 2px solid var(--ui-border);
}

.skill-tab-btn {
    flex: 1;
    padding: 6px;
    background: #34495e;
    color: #ecf0f1;
    border: none;
    cursor: pointer;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    border-right: 1px solid var(--ui-border);
}
.skill-tab-btn:last-child {
    border-right: none;
}
.skill-tab-btn.active {
    background: var(--ui-border);
    color: #141e28;
}
.skill-tab-btn:hover:not(.active) {
    background: #4a6741;
}
.skill-node {
    background-color: #333;
    border: 1px solid #888;
    padding: 8px;
    margin-bottom: 8px;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: grab;
}
.skill-node.locked { 
    opacity: 0.5; 
}
.skill-node h4 { 
    margin: 0 0 4px 0; 
    font-size: var(--font-small);
}
.skill-node p { 
    margin: 0; 
    font-size: var(--font-small); 
}
.skill-node button { 
    padding: 2px 5px; 
    font-size: var(--font-small); 
    margin: 0; 
}
.passive-badge {
    display: inline-block;
    background-color: #4a90e2;
    color: white;
    font-size: var(--font-small);
    padding: 2px 6px;
    border-radius: 3px;
    margin-left: 6px;
    font-weight: bold;
    vertical-align: middle;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
#stat-window-content {
    font-size: var(--font-small);
}

/* New styles for the reorganized layout */
.stat-group {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid var(--ui-border);
}

.stat-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: var(--font-standard);
}

.stat-row span:first-child {
    color: #bdc3c7; /* Lighter color for the label */
    font-size: var(--font-standard);
    font-weight: bold;
    min-width: 50px;
}

.stat-row > div {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: var(--font-standard);
}

.stat-row > div > span:first-child {
    font-size: var(--font-standard);
    font-weight: bold;
    color: white;
    min-width: 30px;
    text-align: right;
}

.ap-display {
    margin-top: 15px;
    text-align: center;
    font-weight: bold;
    font-size: var(--font-standard);
}

.stat-add-btn {
    padding: 0 4px;
    font-size: var(--font-small);
    line-height: 1;
    margin: 0;
    cursor: pointer;
    border: 1px solid #fff;
    background: #555;
}
.stat-bonus { 
    color: cyan !important; 
    text-align: left !important; 
    font-size: var(--font-standard);
    white-space: nowrap;
    flex-shrink: 0;
}

#level-up-notification-container {
    position: absolute;
    /* --- MODIFIED: Positioned above the player's head --- */
    top: -60px;
    left: 50%;
    transform: translateX(-50%);
    width: 300px;
    /* Give it a fixed width for centering */
    /* --- END MODIFIED --- */
    z-index: 250;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    align-items: center;
}
#global-notification-container {
    position: absolute;
    top: 40%;
    /* A little above true center often looks better */
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 250;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.delete-char-btn {
    background-color: var(--hp-color);
    border: 1px solid white;
    color: white;
    padding: 8px 16px;
    font-size: var(--font-standard);
    cursor: pointer;
    font-family: 'Ari9500';
    margin-left: 10px;
}
.delete-char-btn:hover {
    background-color: #a03020;
}

#buff-container {
    position: absolute;
    top: 80px;
    right: 20px;
    left: auto;
    z-index: 101;
    display: flex;
    gap: 5px;
}
.buff-icon {
    width: 48px;
    height: 48px;
    border: 2px solid var(--ui-border);
    background-color: var(--bar-bg);
    position: relative;
    /* Add these three lines for centering */
    display: flex;
    justify-content: center;
    align-items: center;
}
.buff-timer {
    position: absolute;
    bottom: 0;
    right: 2px;
    font-size: var(--font-small);
    text-shadow: 1px 1px #000;
}

.quest-item {
    padding: 8px;
    margin-bottom: 8px;
    background: #2c3e50;
    border-left: 3px solid var(--exp-color);
}
.quest-item.completed {
     border-left: 3px solid #2ecc71;
     opacity: 0.7;
}
.quest-item h4 { margin: 0 0 5px; }
.quest-item p { margin: 0; font-size: var(--font-standard); }

.shop-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px;
    background: #2c3e50;
    margin-bottom: 4px;
    border-radius: 2px;
}
.shop-item button { margin-top: 0; padding: 4px 8px; font-size: var(--font-small); }

.npc-interaction-prompt {
    position: absolute;
    top: -26px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0,0,0,0.7);
    color: white;
    padding: 3px 6px;
    border-radius: 4px;
    border: 1px solid white;
    font-size: var(--font-small);
    display: none;
    z-index: 100;
    white-space: nowrap;
}

.shop-tabs {
    display: flex;
    margin-bottom: 10px;
    border-bottom: 2px solid var(--ui-border);
}
.tab-button {
    flex: 1;
    padding: 6px;
    background: #34495e;
    color: #ecf0f1;
    border: none;
    cursor: pointer;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    border-right: 1px solid var(--ui-border);
}
.tab-button:last-child {
    border-right: none;
}
.tab-button.active {
    background: var(--ui-border);
    color: #141e28;
}
.tab-button:hover:not(.active) {
    background: #4a6741;
}
.tab-content { display: none; }
.tab-content.active { display: block; }

/* Quest Tab Specific Styles */
.quest-tabs {
    display: flex;
    margin-bottom: 10px;
    border-bottom: 2px solid var(--ui-border);
}
.quest-tab-button {
    flex: 1;
    padding: 6px;
    background: #34495e;
    color: #ecf0f1;
    border: none;
    cursor: pointer;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    border-right: 1px solid var(--ui-border);
}
.quest-tab-button:last-child {
    border-right: none;
}
.quest-tab-button.active {
    background: var(--ui-border);
    color: #141e28;
}
.quest-tab-button:hover:not(.active) {
    background: #4a6741;
}
.quest-tab-content { 
    display: none; 
    max-height: 320px;
    overflow-y: auto;
    padding-right: 10px;
    margin-right: -5px;
    padding-bottom: 10px;
}
.quest-tab-content.active { display: block; }

/* Quest Item Styles */
.quest-item {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #444;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
}

.quest-item.available {
    border-left: 4px solid var(--common-color);
}

.quest-item.active {
    border-left: 4px solid var(--exp-color);
}

.quest-item.completed {
    border-left: 4px solid var(--rare-color);
    opacity: 0.8;
}

.quest-item h4 {
    margin: 0 0 6px 0;
    color: #fff;
    font-size: var(--font-small);
}

.quest-item p {
    margin: 3px 0;
    font-size: var(--font-small);
    line-height: 1.3;
}

.quest-description {
    color: #ccc;
    font-style: italic;
}

.quest-objective {
    color: var(--exp-color);
}

.quest-reward {
    color: var(--rare-color);
}

.quest-chain {
    color: var(--legendary-color);
    font-size: var(--font-small);
}

.quest-level {
    color: var(--rare-color);
    font-size: var(--font-small);
    font-weight: bold;
}

/* Quest Count Badges */
.quest-count {
    background: var(--exp-color);
    color: #000;
    border-radius: 10px;
    padding: 2px 6px;
    font-size: var(--font-small);
    margin-left: 5px;
    display: inline-block;
    min-width: 12px;
    text-align: center;
}

/* Progress Bar for Active Quests */
.progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 4px;
    overflow: hidden;
    margin: 5px 0;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--exp-color), var(--rare-color));
    transition: width 0.3s ease;
}
.sell-item-details { display: flex; justify-content: space-between; align-items: center; }
.item-name.common { color: var(--common-color); }
.item-name.rare { color: var(--rare-color); }
.item-name.epic { color: var(--epic-color); }
.item-name.legendary { color: var(--legendary-color); }
.item-name.cosmetic { color: var(--cosmetic-color); }
.item-name.quest { color: var(--quest-color); }

.controls-list {
    list-style: none;
    padding: 0;
    text-align: left;
    margin: 0 auto;
    max-width: 320px;
    font-size: var(--font-standard);
}
.controls-list li { 
    display: flex; 
    justify-content: space-between; 
    margin-bottom: 6px; 
    padding: 2px 0;
}
.controls-list li span:first-child { 
    color: var(--exp-color); 
    margin-right: 15px; 
    font-weight: bold;
    min-width: 60px;
}

/* Key Mapping Styles */
.key-mapping-container {
    max-height: 400px;
    overflow-y: auto;
    padding-right: 10px;
}

.key-mapping-group {
    margin-bottom: 20px;
}

.key-mapping-group h4 {
    color: var(--exp-color);
    margin-bottom: 10px;
    font-size: var(--font-standard);
    border-bottom: 1px solid var(--ui-border);
    padding-bottom: 5px;
}

.key-mapping-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.key-mapping-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
}

.action-name {
    color: #fff;
    font-size: var(--font-standard);
    flex: 1;
}

.key-mapping-button {
    background-color: var(--bar-bg);
    border: 1px solid var(--ui-border);
    color: #fff;
    padding: 8px 16px;
    min-width: 80px;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    cursor: pointer;
    transition: all 0.2s;
}

.key-mapping-button:hover {
    background-color: var(--ui-border);
    border-color: var(--exp-color);
}

.key-mapping-button.capturing {
    background-color: var(--exp-color);
    border-color: #fff;
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.key-mapping-controls {
    margin-top: 20px;
    text-align: center;
    padding-top: 15px;
    border-top: 1px solid var(--ui-border);
}

#enhancement-confirm-modal .window-content { text-align: center; }
#enhancement-info {
    background: #1c2833;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 5px;
    text-align: left;
}
#enhancement-info p { margin: 5px 0; }
#enhancement-info .chance-success { color: var(--success-color); }
#enhancement-info .chance-fail { color: var(--fail-color); }
#enhancement-info .chance-destroy { color: var(--destroy-color); }
#enhancement-confirm-buttons { display: flex; justify-content: space-around; }

.enhancement-bonus {
    color: #f39c12; /* Orange-yellow color for enhancement bonuses */
    font-weight: bold;
}

#minimap-container {
    position: absolute;
    top: 10px;
    left: 10px;
    width: 200px;
    background-color: var(--ui-bg);
    border: 2px solid var(--ui-border);
    z-index: 150;
    color: #fff;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    display: none;
}

/* Party Overlay - under minimap */
#party-overlay {
    position: absolute;
    top: 170px;
    left: 10px;
    width: 200px;
    background-color: var(--ui-bg);
    border: 2px solid var(--ui-border);
    z-index: 149;
    color: #fff;
    font-family: 'Ari9500';
    font-size: var(--font-small);
}
#party-overlay-header {
    background-color: #1c2833;
    padding: 4px 8px;
    border-bottom: 1px solid var(--ui-border);
    font-weight: bold;
    font-size: var(--font-standard);
    cursor: move;
    user-select: none;
}
#party-overlay-members {
    padding: 4px;
    max-height: 150px;
    overflow-y: auto;
}
.party-overlay-member {
    padding: 3px 6px;
    margin: 2px 0;
    border-radius: 3px;
    background: rgba(0, 0, 0, 0.3);
    display: flex;
    flex-direction: column;
    gap: 2px;
}
.party-overlay-member .member-info {
    display: flex;
    align-items: center;
    gap: 6px;
}
.party-overlay-member .member-bars {
    display: flex;
    flex-direction: column;
    gap: 1px;
    margin-left: 16px;
}
.party-overlay-member .member-bar {
    height: 4px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 2px;
    overflow: hidden;
}
.party-overlay-member .member-bar-fill {
    height: 100%;
    transition: width 0.3s ease;
}
.party-overlay-member .hp-bar .member-bar-fill {
    background: linear-gradient(to bottom, #ff6b6b, #c0392b);
}
.party-overlay-member .exp-bar .member-bar-fill {
    background: linear-gradient(to bottom, #f1c40f, #d68910);
}
.party-overlay-member .hp-bar.low .member-bar-fill {
    background: linear-gradient(to bottom, #e74c3c, #922b21);
    animation: pulse-hp 1s infinite;
}
@keyframes pulse-hp {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}
.party-overlay-member .member-level {
    font-size: 9px;
    color: #f1c40f;
    margin-left: auto;
}
.party-overlay-member.same-map {
    background: rgba(46, 204, 113, 0.3);
    border-left: 3px solid #2ecc71;
}
.party-overlay-member.different-map {
    background: rgba(149, 165, 166, 0.2);
    border-left: 3px solid #7f8c8d;
    opacity: 0.7;
}
.party-overlay-member .member-name {
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.party-overlay-member .member-map {
    font-size: 10px;
    color: #95a5a6;
    max-width: 80px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.party-overlay-member.same-map .member-map {
    color: #2ecc71;
}
.party-overlay-member .leader-crown {
    color: #f1c40f;
}
#minimap-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #1c2833;
    padding: 3px 5px;
    border-bottom: 1px solid var(--ui-border);
}
#map-name {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-family: 'Ari9500';
    font-weight: bold;
    font-size: var(--font-standard);
}
#toggle-minimap-btn {
    background: none;
    border: 1px solid var(--ui-border);
    color: #fff;
    cursor: pointer;
    padding: 4px 8px;
    font-family: 'Ari9500';
    font-size: var(--font-small);
    pointer-events: auto;
}
#minimap {
    position: relative;
    width: 100%;
    height: 120px;
    overflow: hidden;
    transition: height 0.2s ease;
}
#minimap.collapsed {
    height: 0;
    padding: 0;
}

#minimap-resize-handle {
    position: absolute;
    width: 12px;
    height: 12px;
    bottom: -2px;
    right: -2px;
    cursor: se-resize;
    border-bottom: 2px solid var(--ui-border);
    border-right: 2px solid var(--ui-border);
    pointer-events: auto;
    z-index: 200;
}

#minimap-player, .minimap-npc, .minimap-monster, .minimap-portal, .minimap-platform, .minimap-boss {
    position: absolute; 
}
#minimap-player { 
    width: 4px; height: 4px; border-radius: 50%; background-color: yellow; z-index: 3; 
}
.minimap-npc { 
    width: 4px; height: 4px; border-radius: 50%; background-color: #2ecc71; z-index: 2; 
} 
.minimap-monster { 
    width: 4px; height: 4px; border-radius: 50%; background-color: #e74c3c; z-index: 1; 
} 
.minimap-portal { 
    width: 6px; height: 6px; border-radius: 50%; background-color: #3498db; z-index: 1; 
} 
.minimap-platform { 
    background-color: #8B4513; z-index: 0; 
}
.minimap-boss {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #f39c12; /* Legendary Orange */
    border: 1px solid white;
    z-index: 2; /* Ensure it draws on top of other monsters */
    animation: pulse 1s infinite;
}
.minimap-ladder {
    background-color: rgba(200, 200, 200, 0.6); /* A light grey color */
    z-index: 0; /* Behind other dots */
}
.minimap-quest-indicator {
    position: absolute;
    top: 50px;
    font-size: var(--font-standard); /* Make it larger than other dots */
    font-weight: bold;
    z-index: 4; /* On top of everything else */
    text-shadow: 1px 1px #000;
    pointer-events: none;
}
.minimap-quest-available {
    color: var(--exp-color); /* Yellow ! */
}
.minimap-quest-complete {
    color: var(--success-color); /* Green ? */
}
.monster-death {
    transition: opacity 0.5s linear, transform 0.5s ease-out;
    opacity: 0;
}
#gm-window {
    width: 450px;
    top: 150px;
    left: 500px;
    transform: none;
}
.gm-control-group {
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--ui-border);
}

.gm-control-group:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

#gm-window-content label {
    display: block;
    margin-bottom: 5px;
    font-size: var(--font-small);
}

#gm-window-content select,
#gm-window-content input {
    width: 100%;
    box-sizing: border-box;
    margin-bottom: 8px;
}

#gm-window-content button {
    margin-top: 0;
}

/* --- Enhanced CRT Shader Effect --- */
/* Fixed CRT settings - always enabled with specific values */
.crt-shader {
    position: relative;
    --crt-intensity: 1; /* Light intensity */
    --crt-scanlines: 0; /* 0% scanlines */
    --crt-curvature: 10; /* 10% curvature */
}

/* Main CRT container styling - always active */
.crt-shader #game-container {
    background: radial-gradient(ellipse at center, #1a1a1a 0%, #000000 100%);
    border-radius: calc(var(--crt-curvature) * 0.3px);
    overflow: hidden;
    position: relative;
}

/* Scanlines overlay - always active */
.crt-shader::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 10000;
    
    /* Dynamic scanlines - dark lines for authentic CRT look */
    background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 1px,
        rgba(0, 0, 0, calc(var(--crt-scanlines) * 0.003 * var(--crt-intensity))) 2px,
        rgba(0, 0, 0, calc(var(--crt-scanlines) * 0.003 * var(--crt-intensity))) 3px,
        transparent 4px
    );
    
    /* Screen curvature and vignette */
    border-radius: calc(var(--crt-curvature) * 0.5px);
    box-shadow: 
        inset 0 0 calc(var(--crt-curvature) * 3px) rgba(0, 0, 0, calc(var(--crt-intensity) * 0.3)),
        inset 0 0 calc(var(--crt-curvature) * 6px) rgba(0, 0, 0, calc(var(--crt-intensity) * 0.2)),
        inset 0 0 calc(var(--crt-curvature) * 12px) rgba(0, 0, 0, calc(var(--crt-intensity) * 0.15));
}

/* Screen glow and subtle effects - always active with phosphor glow */
.crt-shader::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 10001;
    
    /* Subtle screen glow - warm white instead of green */
    background: 
        radial-gradient(ellipse at center, 
            transparent 60%, 
            rgba(255, 255, 255, calc(var(--crt-intensity) * 0.008)) 80%,
            rgba(200, 200, 255, calc(var(--crt-intensity) * 0.015)) 100%);
    
    border-radius: calc(var(--crt-curvature) * 0.5px);
    mix-blend-mode: overlay;
}

/* CRT flicker animation - disabled as requested */
/* Flicker effect removed per user request */

@keyframes crt-flicker {
    0% {
        opacity: 1;
    }
    95% {
        opacity: 1;
    }
    96% {
        opacity: calc(1 - var(--crt-intensity) * 0.05);
    }
    97% {
        opacity: 1;
    }
    98% {
        opacity: calc(1 - var(--crt-intensity) * 0.03);
    }
    100% {
        opacity: 1;
    }
}

/* Enhanced CRT effects on the game canvas - always active */
.crt-shader #game-canvas {
    filter: 
        brightness(calc(1.05 + var(--crt-intensity) * 0.05))
        contrast(calc(1.1 + var(--crt-intensity) * 0.1))
        saturate(calc(0.95 + var(--crt-intensity) * 0.1))
        sepia(calc(var(--crt-intensity) * 0.02));
    
    /* Add subtle barrel distortion */
    transform: perspective(1000px) rotateX(calc(var(--crt-curvature) * 0.02deg)) rotateY(calc(var(--crt-curvature) * 0.01deg));
}

/* Subtle glow on UI elements - can be toggled */
/* Phosphor glow effect - always enabled as requested */
.crt-shader.crt-glow .window {
    box-shadow: 
        0 0 calc(var(--crt-intensity) * 8px) rgba(255, 255, 255, calc(var(--crt-intensity) * 0.08)),
        0 0 calc(var(--crt-intensity) * 16px) rgba(200, 220, 255, calc(var(--crt-intensity) * 0.04)),
        0 2px 4px rgba(0, 0, 0, 0.4);
    
    border: 1px solid rgba(255, 255, 255, calc(var(--crt-intensity) * 0.1));
}

/* Phosphor glow on text - always active as requested */
.crt-shader.crt-glow .window-title {
    text-shadow: 
        0 0 calc(var(--crt-intensity) * 2px) rgba(255, 255, 255, calc(var(--crt-intensity) * 0.3)),
        0 0 calc(var(--crt-intensity) * 4px) rgba(200, 220, 255, calc(var(--crt-intensity) * 0.15));
}

/* Phosphor glow on buttons - always active as requested */
.crt-shader.crt-glow button {
    box-shadow: 
        0 0 calc(var(--crt-intensity) * 4px) rgba(255, 255, 255, calc(var(--crt-intensity) * 0.06));
    
    border: 1px solid rgba(255, 255, 255, calc(var(--crt-intensity) * 0.08));
}

/* Phosphor glow on button hover - always active as requested */
.crt-shader.crt-glow button:hover {
    box-shadow: 
        0 0 calc(var(--crt-intensity) * 6px) rgba(255, 255, 255, calc(var(--crt-intensity) * 0.12)),
        0 0 calc(var(--crt-intensity) * 12px) rgba(200, 220, 255, calc(var(--crt-intensity) * 0.06));
    
    text-shadow: 0 0 calc(var(--crt-intensity) * 1px) rgba(255, 255, 255, calc(var(--crt-intensity) * 0.2));
}

/* Enhanced text glow for CRT effect - always active as requested */
.crt-shader.crt-glow {
    text-shadow: 0 0 calc(var(--crt-intensity) * 1px) rgba(255, 255, 255, calc(var(--crt-intensity) * 0.15));
}

/* Global Tab System Styling - Unified Design */
/* All tab containers should use this consistent styling */
.tabs, .bestiary-tabs, .quest-tabs, .shop-tabs, #inventory-tabs, #skill-tree-tabs {
    display: flex;
    margin-bottom: 10px;
    border-bottom: 2px solid var(--ui-border);
}

/* All tab buttons should use this consistent styling */
.tab-btn, .tab-button, .quest-tab-button, .skill-tab-btn, .bestiary-tab-button {
    flex: 1;
    padding: 6px;
    background: #34495e;
    color: #ecf0f1;
    border: none;
    outline: none;
    cursor: pointer;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    border-right: 1px solid var(--ui-border);
}

.tab-btn:last-child, .tab-button:last-child, .quest-tab-button:last-child, 
.skill-tab-btn:last-child, .bestiary-tab-button:last-child {
    border-right: none;
}

.tab-btn.active, .tab-button.active, .quest-tab-button.active, 
.skill-tab-btn.active, .bestiary-tab-button.active {
    background: var(--ui-border);
    color: #141e28;
}

.tab-btn:hover:not(.active), .tab-button:hover:not(.active), .quest-tab-button:hover:not(.active),
.skill-tab-btn:hover:not(.active), .bestiary-tab-button:hover:not(.active) {
    background: #4a6741;
}

/* Intensity-based presets */
.crt-shader[data-intensity="1"] {
    --crt-intensity: 1;
}

.crt-shader[data-intensity="2"] {
    --crt-intensity: 2;
}

.crt-shader[data-intensity="3"] {
    --crt-intensity: 3;
}

/* Additional visual noise for higher intensities */
.crt-shader[data-intensity="3"]::before {
    background-image: 
        repeating-linear-gradient(
            0deg,
            transparent,
            transparent 1px,
            rgba(0, 0, 0, calc(var(--crt-scanlines) * 0.003 * var(--crt-intensity))) 2px,
            rgba(0, 0, 0, calc(var(--crt-scanlines) * 0.003 * var(--crt-intensity))) 3px,
            transparent 4px
        ),
        /* Add subtle vertical lines for authentic CRT look */
        repeating-linear-gradient(
            90deg,
            transparent,
            transparent 1px,
            rgba(0, 0, 0, 0.015) 2px,
            transparent 3px
        );
}

/* RGB chromatic aberration for highest intensity */
.crt-shader[data-intensity="3"] #game-canvas {
    position: relative;
}

.crt-shader[data-intensity="3"] #game-canvas::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    mix-blend-mode: multiply;
    transform: translateX(0.5px);
    filter: 
        hue-rotate(180deg) 
        saturate(1.5) 
        brightness(0.8)
        contrast(1.2);
    opacity: 0.08;
    pointer-events: none;
}

/* CRT Options Panel Styling */
#crt-options {
    background: rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    padding: 8px;
    margin-top: 8px;
    margin-left: 15px;
}

#crt-options .option-item {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
}

#crt-options .option-item:last-child {
    margin-bottom: 0;
}

#crt-options label {
    flex: 1;
    min-width: 80px;
    font-size: var(--font-small);
}

#crt-options input[type="range"] {
    flex: 2;
    min-width: 60px;
    height: 4px;
}

#crt-options span {
    flex: 0 0 auto;
    min-width: 40px;
    font-size: var(--font-small);
    color: #bdc3c7;
    text-align: right;
}

/* Enhanced slider styling for CRT options */
#crt-options input[type="range"] {
    background: linear-gradient(to right, #333, #666);
    border-radius: 2px;
    height: 4px;
}

#crt-options input[type="range"]::-webkit-slider-thumb {
    background: linear-gradient(45deg, #dddddd, #aaaaaa);
    border: 1px solid #666666;
    box-shadow: 0 0 3px rgba(255, 255, 255, 0.2);
}

#crt-options input[type="range"]::-moz-range-thumb {
    background: linear-gradient(45deg, #dddddd, #aaaaaa);
    border: 1px solid #666666;
    box-shadow: 0 0 3px rgba(255, 255, 255, 0.2);
}

/* Checkbox styling for CRT options */
#crt-options input[type="checkbox"] {
    accent-color: #4a9eff;
}

#crt-options input[type="checkbox"]:checked {
    box-shadow: 0 0 3px rgba(74, 158, 255, 0.4);
}

/* --- Appearance Window Styles --- */
#appearance-content {
    display: flex;
    flex-direction: column;
    gap: 15px;
    padding: 15px;
}

.appearance-control-group {
    display: grid;
    grid-template-columns: 100px 1fr;
    align-items: center;
    gap: 10px;
}

#appearance-hair-color-box,
#appearance-skin-color-box {
    width: auto;
    height: 24px;
    border: 1px solid var(--ui-border);
    margin: 0 5px;
}

#appearance-footer {
    padding: 10px;
    border-top: 1px solid var(--ui-border);
    text-align: center;
    background-color: #1c2833;
}

#appearance-footer p {
    margin: 0 0 10px 0;
    font-size: var(--font-small);
    color: var(--exp-color);
    font-weight: bold;
}

.appearance-actions {
    display: flex;
    justify-content: space-around;
    gap: 10px;
}

#appearance-apply-btn {
    background-color: var(--success-color);
}

#appearance-cancel-btn {
    background-color: var(--fail-color);
}

/* Coin animation for gold drops */
@keyframes coin-spin {
    0% { background-position: 0px 0px; }
    25% { background-position: -24px 0px; }
    50% { background-position: -48px 0px; }
    75% { background-position: -72px 0px; }
    100% { background-position: 0px 0px; }
}

/* Monster Killer Medal Display */
.monster-killer-medal-display {
    position: relative; /* Changed from absolute to work with flex container */
    font-family: 'Ari9500' !important;
    font-size: var(--font-small) !important;
    font-weight: bold !important;
    color: white !important;
    text-shadow: 1px 1px 2px #000000 !important;
    white-space: nowrap;
    padding: 3px 8px;
    border-radius: 4px;
    line-height: 1;
    text-align: center; /* Center text within each medal */
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.monster-killer-medal-display.bronze { 
    background: var(--achievement-bronze);
}

.monster-killer-medal-display.silver { 
    background: var(--achievement-silver);
}

.monster-killer-medal-display.gold { 
    background: var(--achievement-gold);
    position: relative;
    overflow: hidden;
}

.monster-killer-medal-display.gold::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -100%;
    width: 200%;
    height: 200%;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.4),
        transparent
    );
    animation: nameplateShine 3s infinite;
    pointer-events: none;
}

.monster-killer-medal-display.diamond { 
    background: var(--achievement-diamond);
    position: relative;
    overflow: hidden;
}

.monster-killer-medal-display.diamond::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -100%;
    width: 200%;
    height: 200%;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.5),
        transparent
    );
    animation: nameplateShine 2.5s infinite;
    pointer-events: none;
}

/* Epic/Purple tier for special medals (Beta Tester, Founding Player) */
.monster-killer-medal-display.epic { 
    background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 50%, #6c3483 100%);
    position: relative;
    overflow: hidden;
    border: 1px solid #bb8fce;
    box-shadow: 0 0 8px rgba(155, 89, 182, 0.6), inset 0 0 4px rgba(255, 255, 255, 0.2);
}

.monster-killer-medal-display.epic::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -100%;
    width: 200%;
    height: 200%;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.5),
        rgba(200, 150, 255, 0.3),
        transparent
    );
    animation: nameplateShine 2s infinite;
    pointer-events: none;
}

@keyframes nameplateShine {
    0% {
        transform: translateX(-100%);
    }
    100% {
        transform: translateX(100%);
    }
}

.monster-killer-medal-display:hover {
    transform: scale(1.05);
    transition: transform 0.2s ease;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5);
    z-index: 1001; /* Ensure hovered medal appears above others */
}

/* Stat medal indicator - shows which medal gives stats */
.monster-killer-medal-display.stat-medal {
    border-width: 2px;
    font-weight: bold;
}

.monster-killer-medal-display.stat-medal::after {
    margin-left: 4px;
    font-size: 10px;
}

/* Monster Killer Medal Toggle Section in Bestiary */
.monster-killer-medal-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px;
    margin: 5px 0;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 6px;
    border: 1px solid #555;
    gap: 5px;
}

.monster-killer-medal-section .medal-status {
    display: flex;
    align-items: center;
    color: #ffd700;
    font-size: var(--font-small);
}

.monster-killer-medal-section .medal-text {
    font-weight: bold;
    text-align: center;
}

.medal-toggle-btn {
    padding: 4px 8px;
    font-size: var(--font-small);
    font-family: 'Ari9500';
    border: 1px solid #666;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.medal-toggle-btn.visible {
    background: #4CAF50;
    color: white;
    border-color: #45a049;
}

.medal-toggle-btn.visible:hover {
    background: #45a049;
    border-color: #3d8b40;
}

.medal-toggle-btn.hidden {
    background: #f44336;
    color: white;
    border-color: #da190b;
}

.medal-toggle-btn.hidden:hover {
    background: #da190b;
    border-color: #c0392b;
}

/* Bestiary Medals Tab Styles */
.bestiary-medals-header {
    text-align: center;
    margin-bottom: 20px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    border: 1px solid #555;
}

.bestiary-medals-header h3 {
    margin: 0 0 10px 0;
    color: #ffd700;
}

.medals-progress {
    margin: 10px 0;
}

.medals-progress .progress-bar {
    width: 100%;
    height: 20px;
    background: #333;
    border: 1px solid #555;
    border-radius: 10px;
    overflow: hidden;
    margin: 8px 0;
}

.medals-progress .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #ffd700, #ffed4e);
    transition: width 0.3s ease;
}

.medals-progress p {
    margin: 5px 0;
    font-size: var(--font-standard);
    color: #bdc3c7;
}

.medals-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.medal-card {
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid #555;
    border-radius: 8px;
    padding: 15px;
    transition: all 0.3s ease;
}

.medal-card.regular-medal {
    border-color: #4CAF50;
}

.medal-card.boss-medal {
    border-color: #ff6b6b;
    background: rgba(255, 107, 107, 0.1);
}

.medal-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.medal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.medal-header h4 {
    margin: 0;
    color: #ffd700;
    font-size: var(--font-standard);
}

.medal-type {
    font-size: var(--font-small);
    padding: 2px 6px;
    border-radius: 12px;
    color: white;
    font-weight: bold;
}

.medal-card.regular-medal .medal-type {
    background: #4CAF50;
}

.medal-card.boss-medal .medal-type {
    background: #ff6b6b;
}

.medal-info {
    margin: 10px 0;
}

.medal-info p {
    margin: 5px 0;
    font-size: var(--font-standard);
    color: #bdc3c7;
}

.medal-actions {
    text-align: center;
    margin-top: 10px;
}

.no-medals {
    text-align: center;
    padding: 40px;
    color: #bdc3c7;
    font-style: italic;
    grid-column: 1 / -1;
}

.medals-info {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #555;
    border-radius: 8px;
    padding: 15px;
    margin-top: 20px;
}

.medals-info h4 {
    margin: 0 0 10px 0;
    color: #ecf0f1;
}

.medals-info ul {
    margin: 0;
    padding-left: 20px;
}

.medals-info li {
    margin: 5px 0;
    font-size: var(--font-standard);
    color: #bdc3c7;
}

/* Monster Medal Icon in Bestiary Tabs */
.monster-medal-icon {
    display: inline-block;
    margin-left: 5px;
    font-size: var(--font-standard);
    animation: medalGlow 2s ease-in-out infinite alternate;
    filter: drop-shadow(0 0 2px #ffd700);
}

@keyframes medalGlow {
    0% { 
        transform: scale(1);
        filter: drop-shadow(0 0 2px #ffd700);
    }
    100% { 
        transform: scale(1.1);
        filter: drop-shadow(0 0 4px #ffd700);
    }
}

/* === Enhanced Polish & Responsive Design Improvements === */

/* Loading screen improvements */
#loading-screen {
    pointer-events: none;
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

/* Smooth window animations */
.window {
    transition: transform 0.2s ease-out, opacity 0.2s ease-out;
    will-change: transform, opacity;
}

.window.opening {
    animation: windowOpen 0.3s ease-out;
}

.window.closing {
    animation: windowClose 0.2s ease-in forwards;
}

@keyframes windowOpen {
    from {
        transform: scale(0.9);
        opacity: 0;
    }
    to {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes windowClose {
    from {
        transform: scale(1);
        opacity: 1;
    }
    to {
        transform: scale(0.95);
        opacity: 0;
    }
}

/* Fullscreen mode optimizations */
:fullscreen #game-container,
:-webkit-full-screen #game-container,
:-moz-full-screen #game-container {
    background: #000;
}

:fullscreen #scaling-container,
:-webkit-full-screen #scaling-container,
:-moz-full-screen #scaling-container {
    background: transparent;
}

/* Enhanced cursor states */
.draggable {
    cursor: grab;
}

.draggable:active {
    cursor: grabbing;
}

.window-header, .window-title {
    cursor: move;
}

/* Better button interactions */
button:not(.close-btn):hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    transition: all 0.2s ease;
}

button:not(.close-btn):active {
    transform: translateY(0);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

/* Performance optimizations */
canvas {
    will-change: transform;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    transform: translateZ(0);
}

#scaling-container * {
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
}

/* Enhanced game container styling */
#game-container {
    overflow: hidden;
    position: relative;
    background: radial-gradient(ellipse at center, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
}

/* Improved scrollbar styling for windows */
.window-content::-webkit-scrollbar {
    width: 8px;
}

.window-content::-webkit-scrollbar-track {
    background: var(--ui-bg);
    border-radius: 4px;
}

.window-content::-webkit-scrollbar-thumb {
    background: var(--ui-border);
    border-radius: 4px;
    border: 1px solid var(--ui-bg);
}

.window-content::-webkit-scrollbar-thumb:hover {
    background: #5a6570;
}

/* Prevent text selection on UI elements */
.hotbar, .ui-element, .window-title, .tabs {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

/* Smooth transitions for responsive scaling */
#scaling-container {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* --- Font Face Declarations --- */
@font-face {
    font-family: 'Ari9500';
    src: url('./assets/fonts/ari-w9500.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}
@font-face {
    font-family: 'Ari9500';
    src: url('./assets/fonts/ari-w9500-bold.ttf') format('truetype');
    font-weight: bold;
    font-style: normal;
}
@font-face {
    font-family: 'Ari9500Display';
    src: url('./assets/fonts/ari-w9500-display.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}

/* --- Global Styles --- */
body {
    background-color: #000;
    color: #fff;
    font-family: 'Ari9500', sans-serif;
    font-size: var(--font-standard); /* Base font size */
    display: flex; /* ADDED */
    justify-content: center; /* ADDED */
    align-items: center; /* ADDED */
    height: 100vh;
    margin: 0;
    overflow: hidden;
    user-select: none;
}

#loading-screen, #character-name, #game-clock, #start-screen button {
    font-family: 'Ari9500', sans-serif;
}

/* --- Gachapon Window --- */
#gachapon-window {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
}

#gachapon-machine {
    position: relative;
    width: 100%;
    height: 100px;
    background: var(--bar-bg);
    border: 2px solid var(--ui-border);
    border-radius: 5px;
    overflow: hidden;
    margin-bottom: 15px;
}

#gachapon-ticker {
    position: absolute;
    top: -2px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-top: 15px solid var(--exp-color);
    z-index: 3;
    filter: drop-shadow(0 1px 1px #000);
}

#gachapon-wheel {
    width: 100%;
    height: 100%;
    position: relative;
}

#gachapon-wheel-items {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    display: flex;
    align-items: center;
    /* This will be animated */
    transform: translateX(0);
    transition: transform 2.5s cubic-bezier(0.25, 1, 0.5, 1);
}

.gachapon-item {
    width: 80px;
    height: 80px;
    flex-shrink: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid #444;
    margin: 0 5px;
    border-radius: 4px;
    box-sizing: border-box;
    padding: 5px;
}

.gachapon-item .pixel-art {
    transform-origin: center;
}

.gachapon-item-name {
    font-size: var(--font-small);
    color: white;
    margin-top: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
}

#gachapon-controls {
    margin-bottom: 15px;
}

#gachapon-ticket-count {
    margin: 0 0 10px 0;
    color: var(--exp-color);
    font-weight: bold;
}

#gachapon-spin-btn {
    margin-top: 0;
}

#gachapon-result {
    display: none;
    /* Hidden until a prize is won */
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px solid var(--ui-border);
}

#gachapon-result-item {
    margin-top: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    min-height: 40px;
}

/* ========================================================================
   VIRTUAL MOUSE HOVER EFFECTS
   These rules mirror :hover styles for gamepad virtual mouse cursor
   ======================================================================== */

/* Buttons */
#start-screen button.virtual-mouse-hover {
    background-color: #ffc954ad;
}

#character-creation button.virtual-mouse-hover,
#character-selection-screen button.virtual-mouse-hover {
    background: #ffc954;
}

#settings-footer button.virtual-mouse-hover {
    background: #ffc954;
}

.window-content button.virtual-mouse-hover { 
    background: #ffc954;
}

.window-content-button.virtual-mouse-hover,
.option-item button.virtual-mouse-hover {
    background: #ffc954;
}

/* Close button */
.close-btn.virtual-mouse-hover {
    background: #dd6666;
    border-color: #bb4444;
}

/* Hotbar */
.hotbar-slot-btn.virtual-mouse-hover {
    background: rgba(255, 255, 255, 0.15);
}

.hotkey.virtual-mouse-hover {
    background: rgba(255, 255, 255, 0.15);
    transform: scale(1.05);
}

.hotkey.settings-btn.virtual-mouse-hover {
    background: rgba(150, 150, 150, 0.2);
}

/* Tabs */
.tab-btn.virtual-mouse-hover:not(.active) {
    background: #3a5f7d;
}

.tab-button.virtual-mouse-hover:not(.active) {
    background: #3a5f7d;
}

.skill-tab-btn.virtual-mouse-hover:not(.active) {
    background: #3a5f7d;
}

.quest-tab-button.virtual-mouse-hover:not(.active) {
    background: #3a5f7d;
    border-color: #4a7ba7;
}

.bestiary-tab-button.virtual-mouse-hover:not(.active) {
    background: #3a5f7d;
    border-color: #4a7ba7;
}

/* Inventory and Equipment */
.inventory-slot.virtual-mouse-hover,
.equip-slot.virtual-mouse-hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: #4a7ba7;
    box-shadow: 0 0 8px rgba(74, 123, 167, 0.6);
}

#inventory-trash-btn.virtual-mouse-hover:not(:disabled) {
    background: rgba(220, 20, 60, 0.3);
    border-color: #dc143c;
}

/* Character selection */
.character-slot.virtual-mouse-hover {
    transform: scale(1.03);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
}

.delete-char-btn.virtual-mouse-hover {
    background: #e74c3c;
}

/* Job selection */
.job-option.virtual-mouse-hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: #3498db;
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
}

.job-select-btn.virtual-mouse-hover:not(:disabled) {
    background: #ffc954;
}

/* World map */
.world-map-node.discovered.virtual-mouse-hover {
    transform: scale(1.2);
}

/* Bestiary */
.bestiary-monster.clickable.virtual-mouse-hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: #4a7ba7;
}

/* Radial menu */
.radial-menu-item.virtual-mouse-hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

/* Gamepad settings */
.gamepad-action-select.virtual-mouse-hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.15);
    border-color: #4a7ba7;
}

.key-mapping-button.virtual-mouse-hover {
    background: rgba(255, 255, 255, 0.15);
}

/* Medal toggle buttons */
.medal-toggle-btn.visible.virtual-mouse-hover {
    background: #45a049;
    border-color: #3d8b40;
}

.medal-toggle-btn.hidden.virtual-mouse-hover {
    background: #da190b;
    border-color: #c0392b;
}

/* === VFX Bloom Post-Processing Effects === */
/* Subtle bloom effect for VFX elements */

.hitsquib-vfx,
.game-effect,
.loot-effect {
    filter: 
        brightness(1.1) 
        drop-shadow(0 0 2px rgba(255, 255, 255, 0.4))
        drop-shadow(0 0 4px rgba(255, 255, 255, 0.2));
}

/* Quest VFX bloom (subtle yellow glow) */
.quest-vfx {
    filter: 
        brightness(1.15) 
        drop-shadow(0 0 2px rgba(241, 196, 15, 0.5))
        drop-shadow(0 0 4px rgba(241, 196, 15, 0.3));
}

/* Portal effect bloom (subtle cyan glow) */
.portal {
    filter: 
        brightness(1.1) 
        drop-shadow(0 0 2px rgba(192, 245, 255, 0.4))
        drop-shadow(0 0 4px rgba(125, 221, 240, 0.3));
}

/* Projectile bloom (subtle energy glow) */
.projectile {
    filter: 
        brightness(1.15) 
        drop-shadow(0 0 2px rgba(255, 255, 255, 0.4))
        drop-shadow(0 0 4px rgba(255, 255, 255, 0.2));
}

/* Attack box bloom (subtle red glow) */
.attack-box {
    filter: 
        brightness(1.1) 
        drop-shadow(0 0 2px rgba(255, 100, 100, 0.3))
        drop-shadow(0 0 4px rgba(255, 50, 50, 0.2));
}

/* Level up effect canvas bloom (subtle gold glow) */
#player-levelup-effect-canvas {
    filter: 
        brightness(1.15) 
        drop-shadow(0 0 2px rgba(241, 196, 15, 0.5))
        drop-shadow(0 0 4px rgba(241, 196, 15, 0.3));
}

/* === Prevent Browser Zoom === */
html {
    touch-action: pan-x pan-y;
    -ms-touch-action: pan-x pan-y;
}

body {
    touch-action: pan-x pan-y;
    -ms-touch-action: pan-x pan-y;
}

#game-container,
#scaling-container {
    touch-action: none;
    -ms-touch-action: none;
}

/* === Ghost Players === */
.ghost-player {
    position: absolute;
    width: 60px;
    height: 60px;
    pointer-events: none;
    z-index: 10; /* Same as real player */
    transition: none;
}

.ghost-player canvas {
    position: absolute;
    image-rendering: -moz-crisp-edges;
    image-rendering: -webkit-crisp-edges;
    image-rendering: pixelated;
    image-rendering: crisp-edges;
    -ms-interpolation-mode: nearest-neighbor;
}

.ghost-nameplate {
    position: absolute;
    top: 60px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-size: var(--font-small);
    font-family: 'Ari9500';
    font-weight: bold;
    text-shadow: 1px 1px 2px #000;
    white-space: nowrap;
    padding: 2px 6px;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    image-rendering: pixelated;
    line-height: 1;
    pointer-events: none;
}

.ghost-chat-bubble {
    position: absolute;
    top: -60px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(255, 255, 255, 0.9);
    color: #1c2833;
    padding: 6px 10px;
    border-radius: 8px;
    font-size: var(--font-small);
    font-family: 'Ari9500';
    max-width: 300px;
    text-align: center;
    z-index: 100;
    display: none;
    line-height: 1.3;
    /*box-shadow: 2px 2px 5px rgba(0,0,0,0.5);*/
}

@keyframes fadeInScale {
    from {
        opacity: 0;
        transform: translateX(-50%) scale(0.8);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) scale(1);
    }
}

.ghost-attack-effect {
    animation: ghostAttackPulse 0.2s ease-out;
}

@keyframes ghostAttackPulse {
    0% {
        transform: scale(0.5);
        opacity: 1;
    }
    100% {
        transform: scale(1.5);
        opacity: 0;
    }
}

/* Pet Window Styles - Consistent with Bestiary/Achievements */
#pet-window {
    width: 450px;
    max-height: 600px;
}

#pet-window .window-content {
    padding: 15px;
    overflow-y: auto;
    max-height: 550px;
}

.pet-status-display {
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(52, 73, 94, 0.8));
    border: 2px solid #34495e;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 10px;
    text-align: center;
}

.pet-status-display .pet-status-active {
    color: #ecf0f1;
    font-weight: bold;
    margin-bottom: 8px;
}

.pet-status-display .pet-status-info {
    color: #95a5a6;
    font-size: var(--font-small);
}

.pet-list {
    margin-bottom: 10px;
    max-height: 350px;
    overflow-y: auto;
    padding-right: 5px;
}

.pet-list::-webkit-scrollbar {
    width: 6px;
}

.pet-list::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 3px;
}

.pet-list::-webkit-scrollbar-thumb {
    background: #34495e;
    border-radius: 3px;
}

.pet-list::-webkit-scrollbar-thumb:hover {
    background: #4a6741;
}

.pet-entry {
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(52, 73, 94, 0.8));
    border: 2px solid #34495e;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 10px;
    transition: all 0.2s ease;
}

.pet-entry:hover {
    border-color: #5a6d7e;
}

.pet-entry.active {
    border-color: var(--legendary-color);
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.9), rgba(52, 73, 94, 0.9));
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
}

.pet-entry-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 10px;
}

.pet-entry-sprite {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #34495e;
    border-radius: 5px;
    overflow: visible;
}

.pet-entry-info {
    flex: 1;
}

.pet-entry-name {
    color: #ecf0f1;
    font-weight: bold;
    font-size: var(--font-standard);
    margin-bottom: 4px;
}

.pet-entry.active .pet-entry-name {
    color: var(--legendary-color);
}

.pet-entry-status {
    color: #95a5a6;
    font-size: var(--font-small);
}

.pet-entry-status.active-status {
    color: var(--legendary-color);
}

.pet-entry-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 10px;
}

.pet-entry-actions input {
    flex: 1;
    padding: 6px 8px;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #34495e;
    border-radius: 4px;
    color: #ecf0f1;
    font-family: 'Ari9500';
    font-size: var(--font-small);
}

.pet-entry-actions input:focus {
    outline: none;
    border-color: var(--rare-color);
}

.pet-action-btn {
    padding: 6px 12px;
    background: #34495e;
    color: #ecf0f1;
    border: 1px solid #5a6d7e;
    border-radius: 4px;
    cursor: pointer;
    font-family: 'Ari9500';
    font-size: var(--font-small);
    transition: all 0.2s ease;
}

.pet-action-btn:hover {
    background: #4a6741;
    border-color: #4a6741;
}

.pet-action-btn.spawn-btn {
    background: var(--rare-color);
    border-color: var(--rare-color);
}

.pet-action-btn.despawn-btn {
    background: var(--epic-color);
    border-color: var(--epic-color);
}

.pet-loot-toggles {
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(52, 73, 94, 0.8));
    border: 2px solid #34495e;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 10px;
}

.pet-loot-toggles h4 {
    color: #ecf0f1;
    margin: 0 0 10px 0;
    font-size: var(--font-standard);
    font-weight: bold;
}

.pet-toggle-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.pet-toggle-row:last-child {
    border-bottom: none;
}

.pet-toggle-label {
    color: #95a5a6;
    font-size: var(--font-small);
}

.pet-toggle-switch {
    position: relative;
    width: 44px;
    height: 22px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 11px;
    cursor: pointer;
    transition: background 0.3s;
    border: 1px solid #34495e;
}

.pet-toggle-switch.active {
    background: #4a6741;
    border-color: #4a6741;
}

.pet-toggle-switch::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 16px;
    height: 16px;
    background: #ecf0f1;
    border-radius: 50%;
    transition: transform 0.3s;
}

.pet-toggle-switch.active::after {
    transform: translateX(22px);
}

.pet-equipment-section {
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(52, 73, 94, 0.8));
    border: 2px solid #34495e;
    border-radius: 8px;
    padding: 12px;
    text-align: center;
}

.pet-equipment-section h4 {
    color: #ecf0f1;
    margin: 0 0 10px 0;
    font-weight: bold;
}

.pet-no-pets {
    color: #95a5a6;
    font-style: italic;
    padding: 20px;
    text-align: center;
}

.pet-preview-icon {
    animation: petIconFloat 2s ease-in-out infinite;
}

@keyframes petIconFloat {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-3px);
    }
}

/* ===========================================
   ANNOUNCEMENT SYSTEM
   =========================================== */

#announcement-container {
    position: fixed;
    top: 60px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10000;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    pointer-events: none;
}

.announcement-banner {
    background: linear-gradient(135deg, rgba(20, 30, 40, 0.95) 0%, rgba(30, 45, 60, 0.95) 100%);
    border: 2px solid;
    border-radius: 8px;
    padding: 12px 24px;
    font-family: 'Pixel Font', monospace;
    font-size: 14px;
    color: #fff;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    opacity: 0;
    transform: translateY(-20px);
    transition: opacity 0.4s ease, transform 0.4s ease;
    white-space: nowrap;
    max-width: 90vw;
    overflow: hidden;
    text-overflow: ellipsis;
}

.announcement-banner.show {
    opacity: 1;
    transform: translateY(0);
}

.announcement-icon {
    margin-right: 8px;
    font-size: 16px;
}

/* Level Up Announcement */
.announcement-levelup {
    border-color: var(--exp-color);
    background: linear-gradient(135deg, rgba(30, 50, 30, 0.95) 0%, rgba(40, 70, 40, 0.95) 100%);
    animation: announcementGlow 2s ease-in-out infinite;
}

.announcement-levelup .announcement-icon {
    animation: bounceIcon 0.5s ease infinite;
}

/* Job Advancement Announcement */
.announcement-job {
    border-color: var(--legendary-color);
    background: linear-gradient(135deg, rgba(50, 40, 20, 0.95) 0%, rgba(70, 55, 30, 0.95) 100%);
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

/* Achievement Announcement */
.announcement-achievement {
    border-color: var(--rare-color);
    background: linear-gradient(135deg, rgba(30, 40, 60, 0.95) 0%, rgba(40, 55, 80, 0.95) 100%);
}

/* Medal Announcement */
.announcement-medal {
    border-color: var(--epic-color);
    background: linear-gradient(135deg, rgba(50, 30, 50, 0.95) 0%, rgba(70, 45, 70, 0.95) 100%);
}

/* Enhancement +10 Announcement */
.announcement-enhancement {
    border-color: #ff4444;
    background: linear-gradient(135deg, rgba(60, 20, 20, 0.95) 0%, rgba(80, 30, 30, 0.95) 100%);
    box-shadow: 0 4px 15px rgba(255, 68, 68, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    animation: enhancementPulse 1s ease-in-out infinite;
}

@keyframes announcementGlow {
    0%, 100% {
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    50% {
        box-shadow: 0 4px 25px rgba(100, 200, 100, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
}

@keyframes bounceIcon {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-3px);
    }
}

@keyframes enhancementPulse {
    0%, 100% {
        box-shadow: 0 4px 15px rgba(255, 68, 68, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    50% {
        box-shadow: 0 4px 30px rgba(255, 68, 68, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
}

/* ============================================= */
/* Equipment Window Tabs & Medals Section        */
/* ============================================= */

.equipment-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 15px;
    padding: 5px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
}

.equipment-tab-button {
    flex: 1;
    padding: 10px 15px;
    background: rgba(50, 50, 50, 0.8);
    border: 1px solid #444;
    border-radius: 5px;
    color: #aaa;
    font-size: var(--font-standard);
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: 'Ari9500', cursive;
}

.equipment-tab-button:hover {
    background: rgba(70, 70, 70, 0.9);
    color: #fff;
}

.equipment-tab-button.active {
    background: linear-gradient(180deg, #4a6fa5 0%, #3a5a80 100%);
    border-color: #6a9fd5;
    color: #fff;
    box-shadow: 0 2px 8px rgba(74, 111, 165, 0.4);
}

.equipment-tab-content {
    display: none;
}

.equipment-tab-content.active {
    display: block;
}

/* Equipment Medals Container */
.equipment-medals-container {
    padding: 10px;
    max-height: 500px;
    overflow-y: auto;
}

/* Section Headers */
.medals-section {
    margin-bottom: 20px;
}

.medals-section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    background: linear-gradient(90deg, rgba(50, 50, 70, 0.9) 0%, rgba(40, 40, 55, 0.8) 100%);
    border-radius: 8px 8px 0 0;
    border: 1px solid #555;
    border-bottom: none;
}

.medals-section-header h3 {
    margin: 0;
    color: #ffd700;
    font-size: var(--font-header);
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
}

.medals-count {
    background: rgba(0, 0, 0, 0.5);
    padding: 4px 12px;
    border-radius: 15px;
    color: #4CAF50;
    font-weight: bold;
    font-size: var(--font-standard);
}

.medals-progress-inline {
    display: flex;
    align-items: center;
    gap: 10px;
}

.progress-bar-small {
    width: 80px;
    height: 8px;
    background: #222;
    border-radius: 4px;
    overflow: hidden;
    border: 1px solid #444;
}

.progress-bar-small .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #66ff66);
    transition: width 0.3s ease;
}

.medals-subtitle {
    margin: 0;
    padding: 8px 15px;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #555;
    border-top: none;
    border-bottom: none;
    font-size: var(--font-small);
    color: #888;
}

/* Special Medals Grid */
.special-medals-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 10px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #555;
    border-radius: 0 0 8px 8px;
}

.special-medal-card {
    text-align: center;
    padding: 15px 10px;
    border-radius: 8px;
    background: rgba(30, 30, 40, 0.8);
    border: 2px solid #444;
    transition: all 0.3s ease;
    cursor: default;
}

.special-medal-card.earned {
    border-color: #ffd700;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
}

.special-medal-card.earned:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
}

.special-medal-card.locked {
    opacity: 0.5;
    border-color: #333;
}

.special-medal-card .medal-icon {
    font-size: 2rem;
    margin-bottom: 8px;
}

.special-medal-card .medal-name {
    font-size: var(--font-standard);
    color: #fff;
    font-weight: bold;
    margin-bottom: 4px;
}

.special-medal-card .medal-category {
    font-size: var(--font-small);
    color: #888;
}

/* Special Medal Tiers */
.special-medal-card.legendary {
    background: linear-gradient(135deg, rgba(80, 50, 10, 0.9), rgba(120, 80, 20, 0.9));
    border-color: #ff9900;
    animation: legendaryGlow 2s ease-in-out infinite;
}

.special-medal-card.epic {
    background: linear-gradient(135deg, rgba(60, 30, 60, 0.9), rgba(90, 50, 90, 0.9));
    border-color: #9932CC;
}

.special-medal-card.rare {
    background: linear-gradient(135deg, rgba(30, 40, 60, 0.9), rgba(50, 70, 100, 0.9));
    border-color: #4488ff;
}

@keyframes legendaryGlow {
    0%, 100% { box-shadow: 0 0 15px rgba(255, 153, 0, 0.4); }
    50% { box-shadow: 0 0 25px rgba(255, 153, 0, 0.7); }
}

/* Monster Medals Grid */
.monster-medals-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #555;
    border-radius: 0 0 8px 8px;
}

.monster-medal-card {
    padding: 12px;
    border-radius: 6px;
    background: rgba(30, 30, 40, 0.8);
    border: 2px solid #555;
    transition: all 0.2s ease;
}

.monster-medal-card:hover {
    transform: translateY(-2px);
}

.monster-medal-card.boss-medal {
    border-color: #ff6b6b;
    background: rgba(80, 30, 30, 0.6);
}

.monster-medal-card.regular-medal {
    border-color: #4CAF50;
}

/* Medal Tier Colors */
.monster-medal-card.bronze { border-left: 4px solid #cd7f32; }
.monster-medal-card.silver { border-left: 4px solid #c0c0c0; }
.monster-medal-card.gold { border-left: 4px solid #ffd700; }
.monster-medal-card.diamond { 
    border-left: 4px solid #b9f2ff; 
    box-shadow: 0 0 10px rgba(185, 242, 255, 0.3);
}

.medal-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.medal-title {
    font-size: var(--font-standard);
    color: #ffd700;
    font-weight: bold;
}

.medal-type-badge {
    font-size: var(--font-header);
}

.medal-stats {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: var(--font-small);
    color: #aaa;
    margin-bottom: 8px;
}

.medal-visibility.visible { color: #4CAF50; }
.medal-visibility.hidden { color: #888; }

.medal-toggle-btn {
    width: 100%;
    padding: 6px;
    border: 1px solid #555;
    border-radius: 4px;
    background: rgba(50, 50, 50, 0.8);
    color: #aaa;
    font-size: var(--font-small);
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: 'Ari9500', cursive;
}

.medal-toggle-btn:hover {
    background: rgba(70, 70, 70, 0.9);
    color: #fff;
}

.medal-toggle-btn.active {
    background: rgba(76, 175, 80, 0.3);
    border-color: #4CAF50;
    color: #4CAF50;
}

/* Medal Info Section */
.medals-info-section {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #555;
    border-radius: 8px;
    padding: 15px;
}

.medals-info-section h4 {
    margin: 0 0 12px 0;
    color: #ffd700;
    font-size: var(--font-standard);
}

.medal-tiers-guide {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 12px;
}

.tier-item {
    padding: 5px 12px;
    border-radius: 4px;
    font-size: var(--font-small);
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid #444;
}

.tier-item.bronze { border-left: 3px solid #cd7f32; color: #cd7f32; }
.tier-item.silver { border-left: 3px solid #c0c0c0; color: #c0c0c0; }
.tier-item.gold { border-left: 3px solid #ffd700; color: #ffd700; }
.tier-item.diamond { border-left: 3px solid #b9f2ff; color: #b9f2ff; }

.medal-tip {
    margin: 0;
    padding: 10px;
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
    border-radius: 4px;
    font-size: var(--font-small);
    color: #8bc34a;
}

/* Player Online/Offline Notification Toast */
#player-notification-container {
    position: fixed;
    bottom: var(--above-hotbar-keyboard);
    right: var(--left-of-hotbar-keyboard); /* Position to the left of hotbar */
    z-index: 9999;
    display: flex;
    flex-direction: column-reverse;
    gap: 10px;
    pointer-events: none;
    transition: bottom 0.3s ease, right 0.3s ease;
}

/* Adjust player notification position for gamepad mode */
body.gamepad-active #player-notification-container {
    bottom: var(--above-hotbar-gamepad);
    right: var(--left-of-hotbar-gamepad);
}

.player-notification-toast {
    background: var(--ui-bg);
    border: 2px solid #2ecc71;
    border-radius: 5px;
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    animation: playerToastIn 0.3s ease-out, playerToastOut 0.3s ease-in 1.7s forwards;
    min-width: 220px;
    max-width: 320px;
    font-family: 'Ari9500', cursive;
}

@keyframes playerToastIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes playerToastOut {
    from {
        opacity: 1;
        transform: translateY(0);
    }
    to {
        opacity: 0;
        transform: translateY(-20px);
    }
}

.player-notification-toast.offline {
    border-color: #7f8c8d;
}

.player-notification-toast.buddy {
    border-color: #f1c40f;
}

.player-notification-toast.guild {
    border-color: #9b59b6;
}

.player-notification-toast.guild .player-notification-name {
    color: #9b59b6;
}

.player-notification-icon {
    font-size: 24px;
    flex-shrink: 0;
}

.player-notification-content {
    flex: 1;
}

.player-notification-name {
    font-weight: bold;
    color: #fff;
    font-size: var(--font-standard);
    margin-bottom: 2px;
}

.player-notification-toast.buddy .player-notification-name {
    color: #f1c40f;
}

.player-notification-status {
    font-size: var(--font-small);
    color: #bdc3c7;
}

.player-notification-status.online {
    color: #2ecc71;
}

.player-notification-status.offline {
    color: #7f8c8d;
}

@keyframes toastSlideUp {
    from {
        transform: translateY(100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes toastFadeOut {
    from {
        transform: translateY(0);
        opacity: 1;
    }
    to {
        transform: translateY(-20px);
        opacity: 0;
    }
}

/* =============================================
   ACCOUNT SYSTEM STYLES
   ============================================= */

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
}

.modal-content {
    background: var(--ui-bg);
    border: 2px solid var(--ui-border);
    border-radius: 5px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    font-family: 'Ari9500', cursive;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 12px;
    background: var(--ui-border);
}

.modal-header h2 {
    margin: 0;
    color: #141e28;
    font-size: var(--font-header);
    font-weight: bold;
}

.modal-close {
    background: #cc5555;
    border: 1px solid #aa3333;
    color: white;
    font-size: var(--font-standard);
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 2px;
    transition: background 0.2s;
}

.modal-close:hover {
    background: #dd6666;
}

.modal-body {
    padding: 15px;
}

.account-tabs {
    display: flex;
    margin-bottom: 15px;
    border-bottom: 2px solid var(--ui-border);
}

.account-tab {
    flex: 1;
    padding: 8px;
    background: #34495e;
    border: none;
    border-right: 1px solid var(--ui-border);
    color: #ecf0f1;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Ari9500', cursive;
    font-size: var(--font-standard);
}

.account-tab:last-child {
    border-right: none;
}

.account-tab:hover:not(.active) {
    background: #4a6741;
}

.account-tab.active {
    background: var(--ui-border);
    color: #141e28;
}

.account-form {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.account-input {
    padding: 10px 12px;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--ui-border);
    border-radius: 4px;
    color: #ecf0f1;
    font-family: 'Ari9500', cursive;
    font-size: var(--font-standard);
    transition: border-color 0.2s;
}

.account-input:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
}

.account-input::placeholder {
    color: #7f8c8d;
}

.account-btn {
    padding: 10px 20px;
    background: #27ae60;
    border: 1px solid #2ecc71;
    border-radius: 3px;
    color: white;
    font-family: 'Ari9500', cursive;
    font-size: var(--font-standard);
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
}

.account-btn:hover {
    background: #2ecc71;
}

.account-btn.secondary {
    background: #7f8c8d;
    border-color: #95a5a6;
}

.account-btn.secondary:hover {
    background: #95a5a6;
}

.account-error {
    color: #e74c3c;
    font-size: var(--font-standard);
    margin-top: 10px;
    padding: 10px;
    background: rgba(231, 76, 60, 0.2);
    border: 1px solid rgba(231, 76, 60, 0.5);
    border-radius: 4px;
    display: none;
}

.account-error.show {
    display: block;
}

.cloud-save-section {
    margin: 15px 0;
    padding: 12px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

.cloud-save-section h3 {
    margin: 0 0 10px 0;
    color: var(--exp-color);
    font-size: var(--font-standard);
    border-bottom: 1px solid rgba(160, 176, 192, 0.3);
    padding-bottom: 5px;
}

#cloud-saves-list {
    max-height: 150px;
    overflow-y: auto;
    margin-bottom: 10px;
}

.cloud-save-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(52, 73, 94, 0.8));
    border: 2px solid #34495e;
    border-radius: 4px;
    margin-bottom: 5px;
    transition: all 0.2s;
}

.cloud-save-item:hover {
    border-color: #5a6d7e;
    background: linear-gradient(135deg, rgba(52, 73, 94, 0.9), rgba(74, 103, 65, 0.6));
}

.cloud-save-info {
    flex: 1;
}

.cloud-save-name {
    color: var(--exp-color);
    font-weight: bold;
}

.cloud-save-details {
    color: #95a5a6;
    font-size: var(--font-small);
}

.recovery-section {
    margin-bottom: 15px;
}

.recovery-section h3 {
    color: var(--exp-color);
    font-size: var(--font-standard);
    margin-bottom: 10px;
    border-bottom: 1px solid rgba(160, 176, 192, 0.3);
    padding-bottom: 5px;
}

.recovery-char-option {
    padding: 10px 15px;
    margin: 5px 0;
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(52, 73, 94, 0.8));
    border: 2px solid #34495e;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.recovery-char-option:hover {
    border-color: #5a6d7e;
    background: linear-gradient(135deg, rgba(52, 73, 94, 0.9), rgba(74, 103, 65, 0.6));
}

.recovery-char-option strong {
    color: var(--exp-color);
}

#recovery-code-btn,
#account-btn {
    background: #9b59b6;
    border-color: #a569bd;
}

#recovery-code-btn:hover,
#account-btn:hover {
    background: #a569bd;
}

/* =============================================
   UNIFIED GAME MODAL/POPUP STYLES
   Use these classes for consistent UI across the game
   ============================================= */

/* Standard game modal - matches bestiary/window styling */
.game-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10000;
    background: var(--ui-bg);
    border: 2px solid var(--ui-border);
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    animation: modalFadeIn 0.3s ease-out;
    font-family: 'Ari9500', cursive;
    max-width: 90vw;
    max-height: 90vh;
    overflow: hidden;
}

.game-modal-title {
    background: var(--ui-border);
    color: #141e28;
    padding: 6px 12px;
    font-size: var(--font-header);
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.game-modal-content {
    padding: 15px;
    color: #ecf0f1;
    font-size: var(--font-standard);
}

.game-modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    padding: 10px 15px 15px;
}

/* Standard game button - use for all modal buttons */
.game-btn {
    padding: 8px 20px;
    border: none;
    border-radius: 3px;
    color: white;
    cursor: pointer;
    font-family: 'Ari9500', cursive;
    font-size: var(--font-standard);
    transition: all 0.2s;
    background: #34495e;
    border: 1px solid #5a6d7e;
}

.game-btn:hover {
    background: #4a6741;
    border-color: #6a8751;
}

.game-btn.primary {
    background: #2980b9;
    border-color: #3498db;
}

.game-btn.primary:hover {
    background: #3498db;
}

.game-btn.success {
    background: #27ae60;
    border-color: #2ecc71;
}

.game-btn.success:hover {
    background: #2ecc71;
}

.game-btn.danger {
    background: #c0392b;
    border-color: #e74c3c;
}

.game-btn.danger:hover {
    background: #e74c3c;
}

.game-btn.cancel {
    background: #7f8c8d;
    border-color: #95a5a6;
}

.game-btn.cancel:hover {
    background: #95a5a6;
}

/* Subtle inline warning message */
.name-taken-warning {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    margin: 8px 0;
    background: rgba(192, 57, 43, 0.2);
    border: 1px solid #c0392b;
    border-radius: 4px;
    color: #e74c3c;
    font-size: var(--font-standard);
    animation: warningSlideIn 0.3s ease-out;
}

.name-taken-warning .warning-icon {
    color: #e74c3c;
    font-size: var(--font-large);
}

.name-taken-warning strong {
    color: #f1c40f;
}

/* Input error state */
.input-error {
    border-color: #e74c3c !important;
    box-shadow: 0 0 5px rgba(231, 76, 60, 0.5) !important;
}

@keyframes warningSlideIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeOut {
    from {
        opacity: 1;
    }
    to {
        opacity: 0;
    }
}

/* Standard game tabs - matches bestiary tabs */
.game-tabs {
    display: flex;
    margin-bottom: 10px;
    border-bottom: 2px solid var(--ui-border);
}

.game-tab-btn {
    flex: 1;
    padding: 6px;
    background: #34495e;
    color: #ecf0f1;
    border: none;
    cursor: pointer;
    font-family: 'Ari9500';
    font-size: var(--font-standard);
    border-right: 1px solid var(--ui-border);
    transition: all 0.2s;
}

.game-tab-btn:last-child {
    border-right: none;
}

.game-tab-btn.active {
    background: var(--ui-border);
    color: #141e28;
}

.game-tab-btn:hover:not(.active) {
    background: #4a6741;
}

/* Standard game list item - matches bestiary monster style */
.game-list-item {
    background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(52, 73, 94, 0.8));
    border: 2px solid #34495e;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.2s ease;
    cursor: pointer;
}

.game-list-item:hover {
    border-color: #5a6d7e;
    background: linear-gradient(135deg, rgba(52, 73, 94, 0.9), rgba(74, 103, 65, 0.6));
}

.game-list-item.selected {
    border-color: var(--ui-border);
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.8), rgba(52, 73, 94, 0.8));
}

/* Standard game input */
.game-input {
    width: 100%;
    padding: 8px 12px;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--ui-border);
    border-radius: 4px;
    color: #ecf0f1;
    font-family: 'Ari9500', cursive;
    font-size: var(--font-standard);
    box-sizing: border-box;
}

.game-input:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
}

.game-input::placeholder {
    color: #7f8c8d;
}

/* Standard game section header */
.game-section-header {
    font-size: var(--font-standard);
    margin: 10px 0 8px 0;
    color: var(--exp-color);
    border-bottom: 1px solid rgba(160, 176, 192, 0.3);
    padding-bottom: 4px;
}

/* Standard scroll container */
.game-scroll-container {
    overflow-y: auto;
    padding-right: 5px;
}

.game-scroll-container::-webkit-scrollbar {
    width: 8px;
}

.game-scroll-container::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

.game-scroll-container::-webkit-scrollbar-thumb {
    background: #34495e;
    border-radius: 4px;
}

.game-scroll-container::-webkit-scrollbar-thumb:hover {
    background: #4a5568;
}
